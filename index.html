<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

<link rel="icon" type="image/x-icon" href="/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="192x192" href="/android-chrome-192x192.png">
<link rel="icon" type="image/png" sizes="512x512" href="/android-chrome-512x512.png">
<meta name="theme-color" content="#ffffff">
    <title>Nzila Hub</title>
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --primary: #1a237e;
            --primary-light: #534bae;
            --secondary: #311b92;
            --success: #00c853;
            --success-light: #5efc82;
            --success-gradient: linear-gradient(135deg, #00c853 0%, #64dd17 100%);
            --success-bg: rgba(0, 200, 83, 0.1);
            --danger: #f44336;
            --warning: #ff9800;
            --warning-gradient: linear-gradient(135deg, #FF9800 0%, #FFB74D 100%);
            --warning-light: #ffb74d;
            --warning-bg: rgba(255, 152, 0, 0.1);
            --info: #2196F3;
            --info-gradient: linear-gradient(135deg, #2196F3 0%, #1976D2 100%);
            --info-bg: rgba(33, 150, 243, 0.1);
            --invest-gradient: linear-gradient(135deg, #9c27b0 0%, #673ab7 100%);
            --invest-bg: rgba(156, 39, 176, 0.1);
            --dark: #121212;
            --dark-card: #1e1e1e;
            --light: #f8f9fa;
            --gray: #757575;
            --gray-light: #b0b0b0;
            --white: #ffffff;
            --gradient-primary: linear-gradient(135deg, #1a237e 0%, #311b92 100%);
            --gradient-success: linear-gradient(135deg, #00c853 0%, #64dd17 100%);
            --gradient-warning: linear-gradient(135deg, #FF9800 0%, #FFB74D 100%);
            --gradient-card: linear-gradient(135deg, #1e1e1e 0%, #2d2d2d 100%);
            --glass-bg: rgba(255, 255, 255, 0.05);
            --glass-border: rgba(255, 255, 255, 0.1);
            
            /* TEMA CLARO MODERADO */
            --light-primary: #2c5df6;
            --light-secondary: #6a4bff;
            --light-bg: #f0f2f8;
            --light-card: #ffffff;
            --light-text: #2c3e50;
            --light-gray: #7f8c8d;
            --light-gray-light: #95a5a6;
            --light-gradient: linear-gradient(135deg, #2c5df6 0%, #6a4bff 100%);
            --light-glass-bg: rgba(255, 255, 255, 0.7);
            --light-glass-border: rgba(0, 0, 0, 0.1);
            --light-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
            --light-success-bg: rgba(0, 200, 83, 0.08);
            --light-invest-bg: rgba(156, 39, 176, 0.08);
            --light-info-bg: rgba(33, 150, 243, 0.08);
            --light-warning-bg: rgba(255, 152, 0, 0.08);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', -apple-system, BlinkMacSystemFont, sans-serif;
        }

        body {
            background: var(--dark);
            color: var(--white);
            min-height: 100vh;
            padding-bottom: 80px;
            transition: all 0.3s ease;
            overflow-x: hidden;
        }

        body.light-mode {
            background: var(--light-bg);
            color: var(--light-text);
        }

        body.light-mode .header {
            background: var(--light-gradient);
            color: white;
        }

        body.light-mode .card,
        body.light-mode .modal-content,
        body.light-mode .hero-card,
        body.light-mode .stat-card,
        body.light-mode .transactions-list,
        body.light-mode .menu-item,
        body.light-mode .plan-card,
        body.light-mode .history-list,
        body.light-mode .active-plan-card,
        body.light-mode .tab-bar,
        body.light-mode .toast,
        body.light-mode .request-item,
        body.light-mode .plan-detail-item,
        body.light-mode .method-details,
        body.light-mode .bank-account-item,
        body.light-mode .achievement-card,
        body.light-mode .goal-card,
        body.light-mode .news-card {
            background: var(--light-card) !important;
            color: var(--light-text) !important;
            border: 1px solid var(--light-glass-border) !important;
            box-shadow: var(--light-shadow) !important;
        }

        body.light-mode .form-control,
        body.light-mode .view-all-btn,
        body.light-mode .action-btn,
        body.light-mode .method-option,
        body.light-mode .history-tabs,
        body.light-mode .simulation-input {
            background: var(--light-glass-bg) !important;
            color: var(--light-text) !important;
            border-color: var(--light-glass-border) !important;
        }

        /* ESTILOS MELHORADOS PARA SALDOS COM COR LARANJA */
        .balance-amount {
            font-size: 3rem;
            font-weight: 800;
            background: linear-gradient(135deg, #FF9800 0%, #FFB74D 50%, #FFE082 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            letter-spacing: -1px;
            line-height: 1;
            text-shadow: 0 2px 10px rgba(255, 152, 0, 0.3);
            position: relative;
            display: inline-block;
            animation: pulse 2s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.02); }
        }

        body.light-mode .balance-amount {
            background: linear-gradient(135deg, #FF9800 0%, #FFB74D 50%, #FFE082 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-shadow: 0 2px 8px rgba(255, 152, 0, 0.2);
        }

        .invested-amount {
            font-size: 1.8rem;
            font-weight: 700;
            background: linear-gradient(135deg, #9c27b0 0%, #673ab7 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            letter-spacing: -0.5px;
        }

        body.light-mode .invested-amount {
            background: linear-gradient(135deg, #9c27b0 0%, #673ab7 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .plan-amount,
        body.light-mode .plan-amount,
        .stat-card .number,
        body.light-mode .stat-card .number,
        .plan-detail-value,
        body.light-mode .plan-detail-value {
            color: var(--white) !important;
            -webkit-text-fill-color: initial !important;
            background: none !important;
        }

        body.light-mode .greeting,
        body.light-mode .balance-label,
        body.light-mode .invested-label,
        body.light-mode .action-btn span,
        body.light-mode .transaction-details .date,
        body.light-mode .menu-item p,
        body.light-mode .stat-card p,
        body.light-mode .form-group label,
        body.light-mode .plan-period,
        body.light-mode .history-details,
        body.light-mode .history-tab,
        body.light-mode .achievement-desc,
        body.light-mode .goal-desc {
            color: var(--light-gray) !important;
        }

        body.light-mode .agent-badge {
            background: rgba(44, 93, 246, 0.1);
            border-color: rgba(44, 93, 246, 0.2);
            color: var(--light-primary);
        }

        body.light-mode .invite-card {
            background: var(--light-gradient);
            color: white;
        }

        body.light-mode .invite-card h3,
        body.light-mode .invite-card p {
            color: white !important;
        }

        body.light-mode .invite-link {
            background: rgba(255, 255, 255, 0.2);
        }

        body.light-mode .welcome-notification {
            background: var(--light-gradient);
            color: white;
        }

        body.light-mode .welcome-notification h3,
        body.light-mode .welcome-notification p {
            color: white !important;
        }

        body.light-mode .contact-support-warning,
        body.light-mode .next-payment,
        body.light-mode .method-details > div {
            background: rgba(255, 152, 0, 0.08) !important;
            border-color: rgba(255, 152, 0, 0.2) !important;
        }

        /* ESTILOS MELHORADOS DOS CARDS */
        .card {
            background: var(--gradient-card);
            border-radius: 20px;
            padding: 22px;
            margin-bottom: 20px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.4);
            border-color: rgba(255, 255, 255, 0.2);
        }

        body.light-mode .card:hover {
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
            border-color: rgba(0, 0, 0, 0.15);
        }

        .card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: var(--gradient-warning);
            z-index: 1;
        }

        /* Fundo gradiente para os cards especiais */
        .card.gradient-primary {
            background: var(--gradient-primary);
            color: white;
            border: none;
        }

        .card.gradient-success {
            background: var(--gradient-success);
            color: white;
            border: none;
        }

        .card.gradient-warning {
            background: var(--gradient-warning);
            color: white;
            border: none;
        }

        .card.gradient-info {
            background: var(--info-gradient);
            color: white;
            border: none;
        }

        /* Header */
        .header {
            background: var(--gradient-primary);
            padding: 15px 20px;
            position: sticky;
            top: 0;
            z-index: 100;
            backdrop-filter: blur(10px);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
            animation: slideDown 0.3s ease-out;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .top-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .logo h1 {
            font-size: 1.4rem;
            font-weight: 600;
            background: linear-gradient(to right, #fff, #e0e0e0);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        body.light-mode .logo h1 {
            background: linear-gradient(to right, #fff, #e0e0e0);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .user-menu {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .theme-toggle {
            background: var(--glass-bg);
            border: 1px solid var(--glass-border);
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            backdrop-filter: blur(10px);
            transition: all 0.3s;
        }

        body.light-mode .theme-toggle {
            background: rgba(255, 255, 255, 0.2);
            border-color: rgba(255, 255, 255, 0.3);
        }

        .theme-toggle:hover {
            background: rgba(255, 255, 255, 0.1);
            transform: scale(1.05) rotate(15deg);
        }

        .notifications-btn {
            background: var(--glass-bg);
            border: 1px solid var(--glass-border);
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            backdrop-filter: blur(10px);
            transition: all 0.3s;
            position: relative;
        }

        body.light-mode .notifications-btn {
            background: rgba(255, 255, 255, 0.2);
            border-color: rgba(255, 255, 255, 0.3);
        }

        .notifications-btn.has-notifications::after {
            content: '';
            position: absolute;
            top: 5px;
            right: 5px;
            width: 8px;
            height: 8px;
            background: var(--danger);
            border-radius: 50%;
            border: 2px solid var(--primary);
            animation: pulse 1.5s infinite;
        }

        .notifications-btn:hover {
            background: rgba(255, 255, 255, 0.1);
            transform: scale(1.05);
        }

        /* Tab Bar */
        .tab-bar {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: var(--dark-card);
            backdrop-filter: blur(20px);
            display: flex;
            justify-content: space-around;
            padding: 12px 0;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            z-index: 1000;
            animation: slideUp 0.4s ease-out;
        }

        body.light-mode .tab-bar {
            background: rgba(255, 255, 255, 0.95);
            border-top: 1px solid rgba(0, 0, 0, 0.1);
        }

        .tab-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            color: var(--gray-light);
            text-decoration: none;
            transition: all 0.3s;
            padding: 8px 16px;
            border-radius: 12px;
            min-width: 70px;
        }

        body.light-mode .tab-item {
            color: var(--light-gray);
        }

        .tab-item i {
            font-size: 1.4rem;
            margin-bottom: 4px;
            transition: all 0.3s;
        }

        .tab-item span {
            font-size: 0.75rem;
            font-weight: 500;
        }

        .tab-item.active {
            color: var(--white);
            background: var(--glass-bg);
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        body.light-mode .tab-item.active {
            color: white;
            background: var(--light-primary);
        }

        .tab-item.active i {
            color: var(--warning-light);
            transform: scale(1.2);
        }

        body.light-mode .tab-item.active i {
            color: white;
        }

        /* Main Content */
        .container {
            padding: 20px;
            max-width: 500px;
            margin: 0 auto;
        }

        .screen {
            display: none;
            animation: fadeIn 0.4s ease-out;
        }

        .screen.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Hero Card com fundo melhorado */
        .hero-card {
            background: var(--gradient-card);
            border-radius: 24px;
            padding: 25px;
            margin-bottom: 25px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            position: relative;
            overflow: hidden;
            border: 1px solid rgba(255, 255, 255, 0.05);
            position: relative;
            animation: slideUp 0.5s ease-out;
        }

        .hero-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: var(--gradient-warning);
            z-index: 1;
        }

        .hero-card::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: radial-gradient(circle at 30% 20%, rgba(255, 152, 0, 0.1) 0%, transparent 50%),
                       radial-gradient(circle at 80% 80%, rgba(26, 35, 126, 0.1) 0%, transparent 50%);
            z-index: 0;
            animation: float 6s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .hero-card > * {
            position: relative;
            z-index: 2;
        }

        .invested-section {
            background: rgba(156, 39, 176, 0.15);
            border-radius: 16px;
            padding: 20px;
            margin-top: 25px;
            border: 1px solid rgba(156, 39, 176, 0.3);
            position: relative;
            overflow: hidden;
            animation: fadeIn 0.6s ease-out 0.2s both;
        }

        .invested-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(45deg, transparent 30%, rgba(255, 255, 255, 0.03) 100%);
            z-index: 1;
        }

        body.light-mode .invested-section {
            background: var(--light-invest-bg);
            border-color: rgba(156, 39, 176, 0.2);
        }

        body.light-mode .transaction-item:hover,
        body.light-mode .menu-item:hover,
        body.light-mode .action-btn:hover {
            background: rgba(0, 0, 0, 0.03) !important;
        }

        body.light-mode .tab-item {
            color: var(--light-gray);
        }

        body.light-mode .tab-item.active {
            color: white;
            background: var(--light-primary);
        }

        body.light-mode .tab-item.active i {
            color: white;
        }

        body.light-mode .history-tab.active {
            color: white !important;
            background: var(--light-gradient) !important;
        }

        /* Card header melhorado */
        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .greeting {
            font-size: 1rem;
            color: var(--gray-light);
            font-weight: 400;
        }

        .agent-badge {
            background: var(--glass-bg);
            border: 1px solid var(--glass-border);
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 0.85rem;
            backdrop-filter: blur(10px);
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: 500;
            animation: bounceIn 0.5s ease-out;
        }

        @keyframes bounceIn {
            0% {
                opacity: 0;
                transform: scale(0.3);
            }
            50% {
                opacity: 1;
                transform: scale(1.05);
            }
            70% {
                transform: scale(0.9);
            }
            100% {
                transform: scale(1);
            }
        }

        .balance-display {
            text-align: center;
            margin: 30px 0;
            position: relative;
        }

        .balance-label {
            font-size: 1rem;
            color: var(--gray-light);
            margin-bottom: 12px;
            font-weight: 400;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .balance-label i {
            font-size: 0.9rem;
            color: var(--warning-light);
            animation: spin 4s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .invested-label {
            font-size: 0.9rem;
            color: var(--gray-light);
            margin-bottom: 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .invested-label i {
            color: #9c27b0;
        }

        .daily-earnings {
            display: flex;
            justify-content: space-between;
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            font-size: 0.95rem;
        }

        .daily-earnings span:first-child {
            color: var(--gray-light);
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .daily-earnings span:last-child {
            color: var(--success);
            font-weight: 600;
        }

        /* Quick Actions melhorados */
        .quick-actions {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 12px;
            margin-bottom: 25px;
        }

        .action-btn {
            background: var(--glass-bg);
            border: 1px solid var(--glass-border);
            border-radius: 16px;
            padding: 15px 8px;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
            cursor: pointer;
            transition: all 0.3s;
            backdrop-filter: blur(10px);
            position: relative;
            overflow: hidden;
        }

        .action-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: var(--gradient-primary);
            opacity: 0;
            transition: opacity 0.3s;
            z-index: 1;
        }

        .action-btn:hover::before {
            opacity: 0.1;
        }

        .action-btn > * {
            position: relative;
            z-index: 2;
        }

        body.light-mode .action-btn:hover {
            background: rgba(0, 0, 0, 0.05);
            transform: translateY(-5px);
        }

        .action-btn i {
            font-size: 1.6rem;
            margin-bottom: 5px;
            transition: all 0.3s;
        }

        .action-btn:hover i {
            transform: scale(1.2);
        }

        /* Cores específicas para cada ação */
        .action-btn.deposit i { 
            color: #4caf50;
            background: linear-gradient(135deg, #4caf50, #2e7d32);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .action-btn.withdraw i { 
            color: #2196f3;
            background: linear-gradient(135deg, #2196f3, #0d47a1);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .action-btn.invest i { 
            color: #9c27b0;
            background: linear-gradient(135deg, #9c27b0, #4a148c);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .action-btn.friends i { 
            color: #ff9800;
            background: linear-gradient(135deg, #ff9800, #e65100);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        body.light-mode .action-btn i {
            color: var(--light-primary);
        }

        .action-btn span {
            font-size: 0.75rem;
            font-weight: 600;
            color: var(--white);
        }

        body.light-mode .action-btn span {
            color: var(--light-text);
        }

        /* Recent Transactions */
        .section-title {
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .section-title.with-button {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .view-all-btn {
            background: var(--glass-bg);
            border: 1px solid var(--glass-border);
            color: var(--gray-light);
            padding: 8px 15px;
            border-radius: 10px;
            font-size: 0.85rem;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 500;
        }

        .view-all-btn:hover {
            background: rgba(255, 255, 255, 0.1);
            color: white;
            transform: translateY(-2px) scale(1.05);
        }

        body.light-mode .view-all-btn:hover {
            background: rgba(0, 0, 0, 0.05);
            color: var(--light-primary);
        }

        .transactions-list {
            background: var(--dark-card);
            border-radius: 20px;
            overflow: hidden;
            border: 1px solid rgba(255, 255, 255, 0.05);
            min-height: 60px;
            position: relative;
        }

        .transactions-list::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(45deg, transparent 40%, rgba(255, 255, 255, 0.02) 100%);
            pointer-events: none;
        }

        .transaction-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 18px 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            transition: all 0.3s;
            position: relative;
            z-index: 1;
            animation: slideInLeft 0.5s ease-out;
        }

        @keyframes slideInLeft {
            from {
                opacity: 0;
                transform: translateX(-20px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .transaction-item:last-child {
            border-bottom: none;
        }

        .transaction-item:hover {
            background: rgba(255, 255, 255, 0.03);
            transform: translateX(5px);
        }

        body.light-mode .transaction-item:hover {
            background: rgba(0, 0, 0, 0.02);
        }

        .transaction-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .transaction-icon {
            width: 45px;
            height: 45px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.3rem;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.3s;
        }

        .transaction-icon.deposit { 
            background: rgba(76, 175, 80, 0.15); 
            border-color: rgba(76, 175, 80, 0.3);
            color: #4caf50; 
        }
        
        .transaction-icon.withdrawal { 
            background: rgba(33, 150, 243, 0.15); 
            border-color: rgba(33, 150, 243, 0.3);
            color: #2196f3; 
        }
        
        .transaction-icon.investment { 
            background: rgba(156, 39, 176, 0.15); 
            border-color: rgba(156, 39, 176, 0.3);
            color: #9c27b0; 
        }
        
        .transaction-icon.earning { 
            background: rgba(255, 152, 0, 0.15); 
            border-color: rgba(255, 152, 0, 0.3);
            color: #ff9800; 
        }
        
        .transaction-icon.subsidy { 
            background: rgba(255, 193, 7, 0.15); 
            border-color: rgba(255, 193, 7, 0.3);
            color: #ffc107; 
        }
        
        .transaction-icon.commission { 
            background: rgba(156, 39, 176, 0.15); 
            border-color: rgba(156, 39, 176, 0.3);
            color: #9c27b0; 
        }

        .transaction-details h4 {
            font-size: 1rem;
            font-weight: 500;
            margin-bottom: 6px;
        }

        body.light-mode .transaction-details h4 {
            color: var(--light-text);
        }

        .transaction-details .date {
            font-size: 0.85rem;
            color: var(--gray-light);
        }

        .transaction-amount {
            font-weight: 700;
            font-size: 1.1rem;
            transition: all 0.3s;
        }

        .transaction-amount.positive {
            color: var(--success);
        }

        .transaction-amount.negative {
            color: var(--danger);
        }

        /* Menu Screen melhorado */
        .menu-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
            margin-top: 20px;
        }

        .menu-item {
            background: var(--dark-card);
            border: 1px solid rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 18px 12px;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
            position: relative;
            overflow: hidden;
            animation: fadeIn 0.5s ease-out;
            min-height: 120px;
        }

        .menu-item:nth-child(odd) {
            animation-delay: 0.1s;
        }

        .menu-item:nth-child(even) {
            animation-delay: 0.2s;
        }

        .menu-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: var(--gradient-primary);
            opacity: 0;
            transition: opacity 0.3s;
            z-index: 1;
        }

        .menu-item:hover::before {
            opacity: 0.08;
        }

        .menu-item > * {
            position: relative;
            z-index: 2;
        }

        .menu-item:hover {
            transform: translateY(-5px);
            border-color: rgba(255, 255, 255, 0.1);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
        }

        body.light-mode .menu-item:hover {
            background: rgba(0, 0, 0, 0.03);
            border-color: rgba(0, 0, 0, 0.1);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.05);
        }

        .menu-item i {
            font-size: 1.8rem;
            margin-bottom: 8px;
            background: var(--gradient-primary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            transition: all 0.3s;
        }

        .menu-item:hover i {
            transform: scale(1.2);
        }

        .menu-item h3 {
            font-size: 0.85rem;
            font-weight: 600;
            color: var(--white);
            margin-bottom: 5px;
            line-height: 1.2;
        }

        body.light-mode .menu-item h3 {
            color: var(--light-text);
        }

        .menu-item p {
            font-size: 0.75rem;
            color: var(--gray-light);
            line-height: 1.3;
        }

        /* Friends Screen melhorada */
        .friends-stats {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-bottom: 25px;
        }

        .stat-card {
            background: var(--dark-card);
            border-radius: 18px;
            padding: 22px;
            border: 1px solid rgba(255, 255, 255, 0.05);
            position: relative;
            overflow: hidden;
            animation: fadeIn 0.5s ease-out;
        }

        .stat-card:nth-child(1) { animation-delay: 0.1s; }
        .stat-card:nth-child(2) { animation-delay: 0.2s; }
        .stat-card:nth-child(3) { animation-delay: 0.3s; }
        .stat-card:nth-child(4) { animation-delay: 0.4s; }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: var(--gradient-primary);
            opacity: 0.05;
            z-index: 1;
        }

        .stat-card > * {
            position: relative;
            z-index: 2;
        }

        .stat-card i {
            font-size: 1.8rem;
            margin-bottom: 15px;
            background: var(--gradient-primary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .stat-card .number {
            font-size: 2rem;
            font-weight: 800;
            color: var(--white);
            margin: 10px 0;
            letter-spacing: -0.5px;
        }

        .stat-card p {
            font-size: 0.9rem;
            color: var(--gray-light);
            font-weight: 500;
        }

        .invite-card {
            background: var(--gradient-primary);
            border-radius: 20px;
            padding: 25px;
            margin-bottom: 25px;
            position: relative;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(26, 35, 126, 0.3);
            animation: pulse 2s ease-in-out infinite;
        }

        .invite-card::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            right: -50%;
            bottom: -50%;
            background: radial-gradient(circle at center, rgba(255, 255, 255, 0.1) 0%, transparent 70%);
            animation: rotate 20s linear infinite;
        }

        @keyframes rotate {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .invite-card h3 {
            font-size: 1.2rem;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 12px;
            color: white;
            position: relative;
            z-index: 2;
        }

        .invite-card p {
            color: rgba(255, 255, 255, 0.9);
            position: relative;
            z-index: 2;
            font-size: 0.95rem;
            line-height: 1.5;
        }

        .invite-link {
            background: rgba(255, 255, 255, 0.15);
            border-radius: 14px;
            padding: 18px;
            margin: 20px 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            position: relative;
            z-index: 2;
        }

        .copy-btn {
            background: white;
            color: var(--primary);
            border: none;
            padding: 10px 20px;
            border-radius: 10px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.9rem;
        }

        .copy-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        /* Modals */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 2000;
            justify-content: center;
            align-items: center;
            padding: 20px;
            backdrop-filter: blur(10px);
        }

        body.light-mode .modal {
            background: rgba(0, 0, 0, 0.5);
        }

        .modal-content {
            background: var(--dark-card);
            border-radius: 24px;
            padding: 30px;
            width: 100%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
            animation: modalSlide 0.4s ease-out;
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
            position: relative;
        }

        .modal-content::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: radial-gradient(circle at 20% 80%, rgba(255, 152, 0, 0.05) 0%, transparent 50%);
            pointer-events: none;
            z-index: 1;
        }

        .modal-content > * {
            position: relative;
            z-index: 2;
        }

        body.light-mode .modal-content {
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.1);
        }

        @keyframes modalSlide {
            from { 
                opacity: 0; 
                transform: translateY(-40px) scale(0.95); 
            }
            to { 
                opacity: 1; 
                transform: translateY(0) scale(1); 
            }
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
        }

        .modal-header h2 {
            font-size: 1.4rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .close-modal {
            background: rgba(255, 255, 255, 0.1);
            border: none;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            color: white;
            font-size: 1.2rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
        }

        body.light-mode .close-modal {
            background: rgba(0, 0, 0, 0.1);
            color: var(--light-text);
        }

        .close-modal:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: rotate(90deg);
        }

        body.light-mode .close-modal:hover {
            background: rgba(0, 0, 0, 0.15);
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--gray-light);
            font-size: 0.95rem;
        }

        .form-control {
            width: 100%;
            padding: 16px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 14px;
            color: white;
            font-size: 1rem;
            transition: all 0.3s;
            font-weight: 500;
        }

        .form-control:focus {
            outline: none;
            border-color: var(--primary-light);
            background: rgba(255, 255, 255, 0.08);
            box-shadow: 0 0 0 3px rgba(255, 152, 0, 0.2);
        }

        body.light-mode .form-control {
            background: var(--light-glass-bg);
            color: var(--light-text);
            border-color: var(--light-glass-border);
        }

        body.light-mode .form-control:focus {
            border-color: var(--warning);
            background: rgba(255, 152, 0, 0.05);
            box-shadow: 0 0 0 3px rgba(255, 152, 0, 0.1);
        }

        .form-control::placeholder {
            color: var(--gray);
        }

        body.light-mode .form-control::placeholder {
            color: var(--light-gray-light);
        }

        /* Deposit Method Selection */
        .method-selector {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin: 20px 0;
        }

        .method-option {
            background: rgba(255, 255, 255, 0.05);
            border: 2px solid transparent;
            border-radius: 18px;
            padding: 22px 15px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
        }

        .method-option::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: var(--gradient-primary);
            opacity: 0;
            transition: opacity 0.3s;
            z-index: 1;
        }

        .method-option > * {
            position: relative;
            z-index: 2;
        }

        .method-option:hover {
            background: rgba(255, 255, 255, 0.1);
            transform: translateY(-3px);
        }

        body.light-mode .method-option:hover {
            background: rgba(0, 0, 0, 0.03);
        }

        .method-option.selected {
            background: rgba(26, 35, 126, 0.3);
            border-color: var(--primary-light);
            box-shadow: 0 10px 20px rgba(26, 35, 126, 0.2);
        }

        .method-option.selected::before {
            opacity: 0.1;
        }

        body.light-mode .method-option.selected {
            background: rgba(44, 93, 246, 0.1);
            border-color: var(--light-primary);
            box-shadow: 0 10px 20px rgba(44, 93, 246, 0.1);
        }

        .method-option i {
            font-size: 2.2rem;
            margin-bottom: 15px;
            background: var(--gradient-primary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .method-option h4 {
            font-size: 1rem;
            margin-bottom: 8px;
            font-weight: 600;
        }

        .method-option p {
            font-size: 0.85rem;
            color: var(--gray-light);
            line-height: 1.4;
        }

        .method-details {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 18px;
            padding: 22px;
            margin-top: 20px;
            display: none;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .method-details.active {
            display: block;
            animation: fadeIn 0.4s ease-out;
        }

        /* Buttons */
        .btn {
            padding: 18px 24px;
            border: none;
            border-radius: 14px;
            font-size: 1rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            width: 100%;
            position: relative;
            overflow: hidden;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(45deg, transparent 30%, rgba(255, 255, 255, 0.1) 100%);
            opacity: 0;
            transition: opacity 0.3s;
        }

        .btn:hover::before {
            opacity: 1;
        }

        .btn-primary {
            background: var(--gradient-primary);
            color: white;
        }

        body.light-mode .btn-primary {
            background: var(--light-gradient);
        }

        .btn-success {
            background: var(--gradient-success);
            color: white;
        }

        .btn-warning {
            background: var(--gradient-warning);
            color: white;
        }

        .btn-danger {
            background: linear-gradient(135deg, #f44336 0%, #d32f2f 100%);
            color: white;
        }

        .btn-outline {
            background: transparent;
            border: 2px solid var(--primary-light);
            color: var(--primary-light);
        }

        body.light-mode .btn-outline {
            border-color: var(--light-primary);
            color: var(--light-primary);
        }

        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.3);
        }

        body.light-mode .btn:hover {
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.1);
        }

        /* Toast Notifications */
        .toast-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 3000;
            display: flex;
            flex-direction: column;
            gap: 10px;
            max-width: 350px;
        }

        .toast {
            background: var(--dark-card);
            border-left: 4px solid var(--success);
            border-radius: 14px;
            padding: 18px 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.4);
            animation: slideInRight 0.4s ease-out;
            display: flex;
            align-items: center;
            gap: 12px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            position: relative;
            overflow: hidden;
        }

        .toast::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(45deg, transparent 40%, rgba(0, 200, 83, 0.05) 100%);
        }

        .toast.error {
            border-left-color: var(--danger);
        }

        .toast.error::before {
            background: linear-gradient(45deg, transparent 40%, rgba(244, 67, 54, 0.05) 100%);
        }

        .toast.warning {
            border-left-color: var(--warning);
        }

        .toast.warning::before {
            background: linear-gradient(45deg, transparent 40%, rgba(255, 152, 0, 0.05) 100%);
        }

        .toast.info {
            border-left-color: var(--info);
        }

        .toast.info::before {
            background: linear-gradient(45deg, transparent 40%, rgba(33, 150, 243, 0.05) 100%);
        }

        .toast i {
            font-size: 1.4rem;
            position: relative;
            z-index: 2;
        }

        .toast.success i { color: var(--success); }
        .toast.error i { color: var(--danger); }
        .toast.warning i { color: var(--warning); }
        .toast.info i { color: var(--info); }

        .toast-content {
            flex: 1;
            position: relative;
            z-index: 2;
        }

        .toast-title {
            font-weight: 700;
            margin-bottom: 4px;
            font-size: 1rem;
        }

        body.light-mode .toast-title {
            color: var(--light-text);
        }

        .toast-message {
            font-size: 0.9rem;
            color: var(--gray-light);
        }

        .close-toast {
            background: none;
            border: none;
            color: var(--gray-light);
            cursor: pointer;
            font-size: 1.2rem;
            padding: 0;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: all 0.3s;
            position: relative;
            z-index: 2;
        }

        .close-toast:hover {
            background: rgba(255, 255, 255, 0.1);
            color: white;
            transform: rotate(90deg);
        }

        @keyframes slideInRight {
            from {
                opacity: 0;
                transform: translateX(100%);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        /* Investment Plans melhorados */
        .plans-container {
            margin: 20px 0;
            max-height: 500px;
            overflow-y: auto;
            padding-right: 10px;
        }

        .plans-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
        }

        .plan-card {
            background: var(--dark-card);
            border: 1px solid rgba(255, 255, 255, 0.05);
            border-radius: 18px;
            padding: 22px 15px;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
            text-align: center;
            animation: fadeIn 0.5s ease-out;
        }

        .plan-card:nth-child(odd) {
            animation-delay: 0.1s;
        }

        .plan-card:nth-child(even) {
            animation-delay: 0.2s;
        }

        .plan-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: var(--gradient-primary);
            opacity: 0;
            transition: opacity 0.3s;
            z-index: 1;
        }

        .plan-card > * {
            position: relative;
            z-index: 2;
        }

        .plan-card:hover {
            transform: translateY(-5px);
            border-color: var(--primary-light);
            box-shadow: 0 15px 30px rgba(26, 35, 126, 0.2);
        }

        .plan-card:hover::before {
            opacity: 0.05;
        }

        body.light-mode .plan-card:hover {
            border-color: var(--light-primary);
            box-shadow: 0 15px 30px rgba(44, 93, 246, 0.2);
        }

        .plan-card.selected {
            background: rgba(26, 35, 126, 0.3);
            border-color: var(--primary-light);
            box-shadow: 0 15px 30px rgba(26, 35, 126, 0.3);
        }

        .plan-card.selected::before {
            opacity: 0.1;
        }

        body.light-mode .plan-card.selected {
            background: rgba(44, 93, 246, 0.1);
            border-color: var(--light-primary);
            box-shadow: 0 15px 30px rgba(44, 93, 246, 0.2);
        }

        .plan-amount {
            font-size: 1.5rem;
            font-weight: 800;
            color: var(--white);
            margin: 12px 0;
            letter-spacing: -0.5px;
        }

        .plan-daily {
            color: var(--success);
            font-weight: 700;
            margin: 8px 0;
            font-size: 1.1rem;
        }

        .plan-period {
            font-size: 0.9rem;
            color: var(--gray-light);
            font-weight: 500;
        }

        /* Bank Accounts */
        .bank-accounts-list {
            margin: 20px 0;
        }

        .bank-account-item {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 14px;
            padding: 18px;
            margin-bottom: 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
            animation: slideInRight 0.5s ease-out;
        }

        .bank-account-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: var(--gradient-primary);
            opacity: 0;
            transition: opacity 0.3s;
            z-index: 1;
        }

        .bank-account-item > * {
            position: relative;
            z-index: 2;
        }

        .bank-account-item:hover {
            background: rgba(255, 255, 255, 0.08);
            transform: translateY(-3px);
        }

        .bank-account-item:hover::before {
            opacity: 0.05;
        }

        .bank-account-item.selected {
            border-color: var(--success);
            background: rgba(0, 200, 83, 0.1);
        }

        .bank-account-info h4 {
            font-size: 1rem;
            margin-bottom: 6px;
            font-weight: 600;
        }

        .bank-account-info p {
            font-size: 0.85rem;
            color: var(--gray-light);
            font-weight: 500;
        }

        .bank-account-actions {
            display: flex;
            gap: 10px;
        }

        .select-bank-btn {
            background: var(--success);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 8px;
            font-size: 0.85rem;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 600;
        }

        .select-bank-btn:hover {
            background: #00b248;
            transform: scale(1.05);
        }

        .select-bank-btn.selected {
            background: var(--primary);
        }

        body.light-mode .select-bank-btn.selected {
            background: var(--light-primary);
        }

        /* History Section */
        .history-tabs {
            display: flex;
            background: var(--dark-card);
            border-radius: 14px;
            padding: 6px;
            margin-bottom: 20px;
            border: 1px solid rgba(255, 255, 255, 0.05);
        }

        .history-tab {
            flex: 1;
            padding: 14px;
            text-align: center;
            cursor: pointer;
            border-radius: 10px;
            font-weight: 600;
            transition: all 0.3s;
            color: var(--gray-light);
            font-size: 0.9rem;
        }

        .history-tab.active {
            background: var(--gradient-primary);
            color: white;
            box-shadow: 0 5px 15px rgba(26, 35, 126, 0.3);
        }

        body.light-mode .history-tab.active {
            background: var(--light-gradient);
            color: white !important;
        }

        .history-list {
            background: var(--dark-card);
            border-radius: 20px;
            overflow: hidden;
            border: 1px solid rgba(255, 255, 255, 0.05);
            max-height: 400px;
            overflow-y: auto;
            position: relative;
        }

        .history-list::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(45deg, transparent 40%, rgba(255, 255, 255, 0.02) 100%);
            pointer-events: none;
        }

        .history-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 18px 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            position: relative;
            z-index: 1;
            animation: fadeIn 0.5s ease-out;
        }

        .history-item:last-child {
            border-bottom: none;
        }

        .history-info {
            flex: 1;
        }

        .history-title {
            font-weight: 600;
            margin-bottom: 6px;
            font-size: 1rem;
        }

        .history-details {
            display: flex;
            gap: 15px;
            font-size: 0.85rem;
            color: var(--gray-light);
        }

        .history-status {
            font-size: 0.8rem;
            padding: 6px 12px;
            border-radius: 8px;
            font-weight: 700;
            min-width: 100px;
            text-align: center;
        }

        .status-pending { background: rgba(255, 152, 0, 0.15); color: #ff9800; border: 1px solid rgba(255, 152, 0, 0.3); }
        .status-approved { background: rgba(76, 175, 80, 0.15); color: #4caf50; border: 1px solid rgba(76, 175, 80, 0.3); }
        .status-rejected { background: rgba(244, 67, 54, 0.15); color: #f44336; border: 1px solid rgba(244, 67, 54, 0.3); }
        .status-completed { background: rgba(33, 150, 243, 0.15); color: #2196f3; border: 1px solid rgba(33, 150, 243, 0.3); }

        .empty-history {
            text-align: center;
            padding: 50px 20px;
            color: var(--gray-light);
            position: relative;
            z-index: 2;
        }

        .empty-history i {
            font-size: 3.5rem;
            margin-bottom: 20px;
            opacity: 0.5;
            background: var(--gradient-primary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .empty-history h3 {
            font-size: 1.2rem;
            margin-bottom: 10px;
            font-weight: 600;
        }

        .empty-history p {
            font-size: 0.95rem;
            margin-bottom: 20px;
        }

        /* My Plans Screen */
        .active-plan-card {
            background: var(--gradient-card);
            border-radius: 20px;
            padding: 25px;
            margin-bottom: 25px;
            border: 1px solid rgba(255, 255, 255, 0.05);
            position: relative;
            overflow: hidden;
            animation: slideUp 0.5s ease-out;
        }

        .active-plan-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: radial-gradient(circle at 20% 80%, rgba(255, 152, 0, 0.1) 0%, transparent 50%);
        }

        .active-plan-card > * {
            position: relative;
            z-index: 2;
        }

        .plan-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
        }

        .plan-status {
            background: rgba(0, 200, 83, 0.15);
            color: var(--success);
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 700;
            border: 1px solid rgba(0, 200, 83, 0.3);
        }

        .plan-details {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin: 25px 0;
        }

        .plan-detail-item {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 14px;
            padding: 18px;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.1);
            animation: fadeIn 0.5s ease-out;
        }

        .plan-detail-item:nth-child(1) { animation-delay: 0.1s; }
        .plan-detail-item:nth-child(2) { animation-delay: 0.2s; }
        .plan-detail-item:nth-child(3) { animation-delay: 0.3s; }
        .plan-detail-item:nth-child(4) { animation-delay: 0.4s; }

        .plan-detail-label {
            font-size: 0.85rem;
            color: var(--gray-light);
            margin-bottom: 8px;
            font-weight: 500;
        }

        .plan-detail-value {
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--white);
        }

        .next-payment {
            background: rgba(33, 150, 243, 0.15);
            border-left: 4px solid var(--info);
            padding: 16px;
            border-radius: 12px;
            margin: 20px 0;
            border: 1px solid rgba(33, 150, 243, 0.3);
        }

        .next-payment h4 {
            font-size: 0.95rem;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 10px;
            font-weight: 600;
        }

        .next-payment p {
            font-size: 0.9rem;
            color: var(--gray-light);
            line-height: 1.5;
        }

        /* Contact Support Warning */
        .contact-support-warning {
            background: rgba(255, 152, 0, 0.15);
            border-left: 4px solid var(--warning);
            padding: 16px;
            border-radius: 12px;
            margin: 20px 0;
            border: 1px solid rgba(255, 152, 0, 0.3);
        }

        .contact-support-warning p {
            font-size: 0.9rem;
            color: var(--gray-light);
            display: flex;
            align-items: center;
            gap: 10px;
            line-height: 1.5;
        }

        /* Welcome Notification */
        .welcome-notification {
            background: var(--gradient-primary);
            border-radius: 18px;
            padding: 25px;
            margin-bottom: 25px;
            animation: slideInDown 0.5s ease-out;
            position: relative;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(26, 35, 126, 0.3);
        }

        .welcome-notification::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: radial-gradient(circle at 80% 20%, rgba(255, 255, 255, 0.1) 0%, transparent 50%);
        }

        @keyframes slideInDown {
            from {
                opacity: 0;
                transform: translateY(-30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .welcome-notification h3 {
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 12px;
            color: white;
            font-size: 1.3rem;
            position: relative;
            z-index: 2;
        }

        .welcome-notification p {
            margin-bottom: 20px;
            font-size: 0.95rem;
            color: rgba(255, 255, 255, 0.9);
            line-height: 1.6;
            position: relative;
            z-index: 2;
        }

        .telegram-btn {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.3);
            padding: 16px 24px;
            border-radius: 12px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            width: 100%;
            font-size: 1rem;
            position: relative;
            z-index: 2;
            backdrop-filter: blur(10px);
        }

        .telegram-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-3px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
        }

        /* Responsive */
        @media (max-width: 480px) {
            .container {
                padding: 15px;
            }
            
            .quick-actions {
                grid-template-columns: repeat(2, 1fr);
                gap: 10px;
            }
            
            .menu-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .friends-stats {
                grid-template-columns: 1fr;
            }
            
            .plans-grid {
                grid-template-columns: 1fr;
            }
            
            .balance-amount {
                font-size: 2.5rem;
            }
            
            .plan-details {
                grid-template-columns: 1fr;
            }
            
            .method-selector {
                grid-template-columns: 1fr;
            }
            
            .hero-card {
                padding: 20px;
            }
            
            .stat-card {
                padding: 18px;
            }
            
            .modal-content {
                padding: 20px;
            }
        }

        /* Loading States */
        .loading {
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 60px 20px;
            position: relative;
            z-index: 2;
        }

        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 3px solid var(--glass-border);
            border-top: 3px solid var(--warning);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Efeitos de brilho */
        .glow {
            position: relative;
        }

        .glow::after {
            content: '';
            position: absolute;
            top: -2px;
            left: -2px;
            right: -2px;
            bottom: -2px;
            background: var(--gradient-warning);
            border-radius: inherit;
            z-index: -1;
            opacity: 0;
            transition: opacity 0.3s;
        }

        .glow:hover::after {
            opacity: 0.3;
        }

        /* Estilos para novos modais */
        .simulation-input {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 15px;
            margin: 15px 0;
            display: flex;
            gap: 10px;
        }

        .simulation-input input {
            flex: 1;
            background: transparent;
            border: none;
            color: white;
            font-size: 1rem;
            outline: none;
        }

        .simulation-results {
            background: rgba(0, 200, 83, 0.1);
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
            border: 1px solid rgba(0, 200, 83, 0.2);
        }

        .achievement-card {
            background: var(--dark-card);
            border-radius: 15px;
            padding: 18px;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 15px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            animation: fadeIn 0.5s ease-out;
        }

        .achievement-icon {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: var(--gradient-warning);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            color: white;
        }

        .achievement-details {
            flex: 1;
        }

        .achievement-title {
            font-weight: 600;
            margin-bottom: 5px;
            font-size: 0.95rem;
        }

        .achievement-desc {
            font-size: 0.8rem;
            color: var(--gray-light);
        }

        .achievement-progress {
            height: 6px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 3px;
            margin-top: 8px;
            overflow: hidden;
        }

        .achievement-progress-bar {
            height: 100%;
            background: var(--gradient-warning);
            border-radius: 3px;
            transition: width 0.3s;
        }

        .goal-card {
            background: var(--dark-card);
            border-radius: 15px;
            padding: 18px;
            margin-bottom: 12px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            animation: fadeIn 0.5s ease-out;
        }

        .goal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .goal-title {
            font-weight: 600;
            font-size: 1rem;
        }

        .goal-amount {
            font-weight: 700;
            color: var(--success);
            font-size: 1.1rem;
        }

        .goal-progress {
            margin: 15px 0;
        }

        .goal-progress-text {
            display: flex;
            justify-content: space-between;
            font-size: 0.85rem;
            color: var(--gray-light);
            margin-bottom: 5px;
        }

        .goal-progress-bar {
            height: 8px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
            overflow: hidden;
        }

        .goal-progress-fill {
            height: 100%;
            background: var(--gradient-success);
            border-radius: 4px;
            transition: width 0.3s;
        }

        .news-card {
            background: var(--dark-card);
            border-radius: 15px;
            padding: 18px;
            margin-bottom: 12px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            animation: fadeIn 0.5s ease-out;
        }

        .news-date {
            font-size: 0.75rem;
            color: var(--gray-light);
            margin-bottom: 8px;
        }

        .news-title {
            font-weight: 600;
            font-size: 0.95rem;
            margin-bottom: 8px;
        }

        .news-content {
            font-size: 0.85rem;
            color: var(--gray-light);
            line-height: 1.4;
        }

        .chart-container {
            background: var(--dark-card);
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .cashback-badge {
            background: var(--gradient-success);
            color: white;
            padding: 4px 10px;
            border-radius: 10px;
            font-size: 0.75rem;
            font-weight: 600;
            display: inline-block;
            margin-left: 8px;
        }

        .security-session {
            background: var(--dark-card);
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 10px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .session-info {
            flex: 1;
        }

        .session-device {
            font-weight: 600;
            font-size: 0.9rem;
            margin-bottom: 5px;
        }

        .session-details {
            font-size: 0.8rem;
            color: var(--gray-light);
        }

        .session-status {
            padding: 4px 10px;
            border-radius: 8px;
            font-size: 0.75rem;
            font-weight: 600;
        }

        .session-active {
            background: rgba(0, 200, 83, 0.15);
            color: var(--success);
        }

        .plan-comparison {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin: 20px 0;
        }

        .comparison-card {
            background: var(--dark-card);
            border-radius: 15px;
            padding: 18px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            text-align: center;
        }

        .comparison-card.highlighted {
            border-color: var(--warning);
            box-shadow: 0 5px 15px rgba(255, 152, 0, 0.2);
        }

        .comparison-title {
            font-weight: 600;
            font-size: 0.9rem;
            margin-bottom: 10px;
            color: var(--gray-light);
        }

        .comparison-value {
            font-weight: 800;
            font-size: 1.2rem;
            color: var(--white);
            margin-bottom: 5px;
        }

        .comparison-diff {
            font-size: 0.85rem;
            font-weight: 600;
        }

        .comparison-diff.positive {
            color: var(--success);
        }

        .comparison-diff.negative {
            color: var(--danger);
        }
    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <!-- Header -->
    <div class="header">
        <div class="top-bar">
            <div class="logo">
                <i class="fas fa-chart-line" style="color: #ff9800;"></i>
                <h1>Nzila Hub</h1>
            </div>
            <div class="user-menu">
                <button class="theme-toggle" id="themeToggle" onclick="toggleTheme()">
                    <i class="fas fa-moon"></i>
                </button>
                <button class="notifications-btn" id="notificationsBtn" onclick="showNotifications()">
                    <i class="fas fa-bell"></i>
                </button>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <div class="container">
        <!-- Welcome Notification -->
        <div id="welcomeNotification" class="welcome-notification" style="display: none;">
            <h3><i class="fas fa-rocket"></i> Bem-vindo à Plataforma Nzila!</h3>
            <p>Junta-te à nossa comunidade no Telegram para suporte 24/7, dicas de investimento e as últimas atualizações.</p>
            <button class="telegram-btn" onclick="joinTelegramGroup()">
                <i class="fab fa-telegram"></i> Entrar no Grupo do Telegram
            </button>
        </div>

        <!-- Home Screen -->
        <div id="homeScreen" class="screen active">
            <!-- Hero Card com fundo melhorado -->
            <div class="hero-card">
                <div class="card-header">
                    <div class="greeting">Olá, <span id="agentNumber" style="color: #fff; font-weight: 600;">---</span></div>
                    <div class="agent-badge">
                        <i class="fas fa-id-card"></i>
                        <span>Agente #<span id="agentCodeDisplay" style="font-weight: 700;">---</span></span>
                    </div>
                </div>
                
                <div class="balance-display">
                    <div class="balance-label">
                        <i class="fas fa-wallet"></i> Saldo Disponível
                    </div>
                    <div class="balance-amount" id="balanceAmount">0 Kz</div>
                </div>
                
                <div class="invested-section">
                    <div class="invested-label">
                        <span><i class="fas fa-chart-line"></i> Saldo Investido</span>
                        <span style="color: #5efc82; font-weight: 600;"><i class="fas fa-arrow-up"></i> Rendendo</span>
                    </div>
                    <div class="invested-amount" id="investedAmount">0 Kz</div>
                    <div class="daily-earnings">
                        <span><i class="fas fa-coins"></i> Ganhos Diários</span>
                        <span id="dailyEarningsAmount" style="font-weight: 700;">0 Kz</span>
                    </div>
                </div>
            </div>

            <!-- Quick Actions com ícones e fundos melhorados -->
            <div class="quick-actions">
                <div class="action-btn deposit glow" onclick="openModal('depositModal')">
                    <i class="fas fa-credit-card"></i>
                    <span>Depositar</span>
                </div>
                <div class="action-btn withdraw glow" onclick="openModal('withdrawalModal')">
                    <i class="fas fa-money-check-alt"></i>
                    <span>Levantar</span>
                </div>
                <div class="action-btn invest glow" onclick="openModal('investmentModal')">
                    <i class="fas fa-chart-line"></i>
                    <span>Investir</span>
                </div>
                <div class="action-btn friends glow" onclick="showScreen('friends')">
                    <i class="fas fa-users"></i>
                    <span>Amigos</span>
                </div>
            </div>

            <!-- Recent Transactions com fundo -->
            <h2 class="section-title with-button">
                <span><i class="fas fa-history"></i> Histórico Recente</span>
                <button class="view-all-btn" onclick="openModal('withdrawalHistoryModal')">
                    Ver Tudo <i class="fas fa-arrow-right"></i>
                </button>
            </h2>
            <div class="transactions-list" id="recentTransactions">
                <div class="loading">
                    <div class="loading-spinner"></div>
                </div>
            </div>
        </div>

        <!-- Friends Screen com fundos melhorados -->
        <div id="friendsScreen" class="screen">
            <div class="invite-card">
                <h3><i class="fas fa-share-alt"></i> Convide Amigos</h3>
                <p>Ganhe 15% de comissão sobre o primeiro investimento de cada referido</p>
                
                <div class="invite-link">
                    <span style="font-size: 0.9rem; word-break: break-all; font-weight: 500;" id="inviteLinkText">Carregando...</span>
                    <button class="copy-btn" onclick="copyInviteLink()">
                        <i class="far fa-copy"></i> Copiar
                    </button>
                </div>
            </div>

            <div class="friends-stats">
                <div class="stat-card">
                    <i class="fas fa-user-check"></i>
                    <div class="number" id="investedFriends">0</div>
                    <p>Amigos Investidos</p>
                </div>
                
                <div class="stat-card">
                    <i class="fas fa-users"></i>
                    <div class="number" id="registeredFriends">0</div>
                    <p>Referidos Registrados</p>
                </div>
                
                <div class="stat-card">
                    <i class="fas fa-hand-holding-usd"></i>
                    <div class="number" id="totalCommission">0 Kz</div>
                    <p>Comissão Total</p>
                </div>
                
                <div class="stat-card">
                    <i class="fas fa-gift"></i>
                    <div class="number" id="activeInvestments">0</div>
                    <p>Planos Ativos</p>
                </div>
            </div>
            
            <!-- Lista de Amigos Referenciados -->
            <h2 class="section-title" style="margin-top: 30px;">
                <i class="fas fa-user-friends"></i> Meus Referidos
            </h2>
            <div class="history-list" id="referralsList">
                <div class="loading">
                    <div class="loading-spinner"></div>
                </div>
            </div>
        </div>

        <!-- Menu Screen melhorado -->
        <div id="menuScreen" class="screen">
            <div class="menu-grid">
                <!-- Menu Original -->
                <div class="menu-item glow" onclick="openModal('ibanModal')">
                    <i class="fas fa-university"></i>
                    <h3>Contas Bancárias</h3>
                    <p>Gerir suas contas para levantamentos</p>
                </div>
                
                <div class="menu-item glow" onclick="openModal('profileModal')">
                    <i class="fas fa-user-circle"></i>
                    <h3>Meu Perfil</h3>
                    <p>Dados pessoais e configurações</p>
                </div>
                
                <div class="menu-item glow" onclick="showScreen('myPlans')">
                    <i class="fas fa-chart-line"></i>
                    <h3>Meus Planos</h3>
                    <p>Ver planos ativos e rendimentos</p>
                </div>
                
                <div class="menu-item glow" onclick="openModal('investmentModal')">
                    <i class="fas fa-plus-circle"></i>
                    <h3>Investir</h3>
                    <p>Novos planos de investimento</p>
                </div>
                
                <div class="menu-item glow" onclick="openModal('cancelModal')">
                    <i class="fas fa-ban"></i>
                    <h3>Cancelar</h3>
                    <p>Solicitar retorno do capital</p>
                </div>
                
                <div class="menu-item glow" onclick="openModal('subsidiesModal')">
                    <i class="fas fa-gift"></i>
                    <h3>Subsídios</h3>
                    <p>Histórico de 8% semanais</p>
                </div>
                
                <div class="menu-item glow" onclick="openModal('withdrawalHistoryModal')">
                    <i class="fas fa-history"></i>
                    <h3>Histórico</h3>
                    <p>Ver transações realizadas</p>
                </div>
                
                <!-- Novos Itens do Menu -->
                <div class="menu-item glow" onclick="openModal('analyticsModal')">
                    <i class="fas fa-chart-bar"></i>
                    <h3>Analytics</h3>
                    <p>Gráficos de crescimento</p>
                </div>
                
                <div class="menu-item glow" onclick="openModal('simulatorModal')">
                    <i class="fas fa-calculator"></i>
                    <h3>Simulador</h3>
                    <p>Simule seus investimentos</p>
                </div>
                
                <div class="menu-item glow" onclick="openModal('goalsModal')">
                    <i class="fas fa-bullseye"></i>
                    <h3>Metas</h3>
                    <p>Defina objetivos financeiros</p>
                </div>
                
                <div class="menu-item glow" onclick="openModal('achievementsModal')">
                    <i class="fas fa-trophy"></i>
                    <h3>Conquistas</h3>
                    <p>Prêmios e badges</p>
                </div>
                
                <div class="menu-item glow" onclick="openModal('cashbackModal')">
                    <i class="fas fa-percentage"></i>
                    <h3>Cashback</h3>
                    <p>Ganhe bônus extras</p>
                </div>
                
                <div class="menu-item glow" onclick="openModal('plannerModal')">
                    <i class="fas fa-calendar-alt"></i>
                    <h3>Planejador</h3>
                    <p>Calendário financeiro</p>
                </div>
                
                <div class="menu-item glow" onclick="openModal('newsModal')">
                    <i class="fas fa-newspaper"></i>
                    <h3>Notícias</h3>
                    <p>Dicas e atualizações</p>
                </div>
                
                <div class="menu-item glow" onclick="openModal('securityModal')">
                    <i class="fas fa-shield-alt"></i>
                    <h3>Segurança</h3>
                    <p>Sessões e segurança</p>
                </div>
                
                <div class="menu-item glow" onclick="openModal('comparisonModal')">
                    <i class="fas fa-balance-scale"></i>
                    <h3>Comparar</h3>
                    <p>Compare planos</p>
                </div>
                
                <div class="menu-item glow" onclick="toggleTheme()">
                    <i class="fas fa-moon"></i>
                    <h3>Tema</h3>
                    <p>Escuro/Claro</p>
                </div>
                
                <div class="menu-item glow" onclick="openSupport()">
                    <i class="fab fa-telegram"></i>
                    <h3>Suporte</h3>
                    <p>Fale com nossa equipe</p>
                </div>
                
                <div class="menu-item glow" onclick="openModal('aboutModal')">
                    <i class="fas fa-info-circle"></i>
                    <h3>Sobre</h3>
                    <p>Conheça a plataforma</p>
                </div>
                
                <div class="menu-item glow" onclick="logout()" style="background: rgba(244, 67, 54, 0.15); border-color: rgba(244, 67, 54, 0.3);">
                    <i class="fas fa-sign-out-alt" style="background: linear-gradient(135deg, #f44336, #d32f2f); -webkit-background-clip: text; -webkit-text-fill-color: transparent;"></i>
                    <h3 style="color: #f44336;">Sair</h3>
                    <p>Terminar sessão</p>
                </div>
            </div>
        </div>

        <!-- My Plans Screen com fundo -->
        <div id="myPlansScreen" class="screen">
            <h2 class="section-title">
                <i class="fas fa-chart-line"></i> Meus Planos Ativos
            </h2>
            
            <div id="activePlansContainer">
                <div class="loading">
                    <div class="loading-spinner"></div>
                </div>
            </div>

            <div class="contact-support-warning">
                <p>
                    <i class="fas fa-exclamation-triangle"></i>
                    <strong>Atenção:</strong> Você só pode ter um investimento ativo por vez. Para alterar seu plano, entre em contacto com o suporte.
                </p>
            </div>
        </div>
    </div>

    <!-- Tab Bar -->
    <div class="tab-bar">
        <div class="tab-item active" onclick="showScreen('home')">
            <i class="fas fa-home"></i>
            <span>Início</span>
        </div>
        <div class="tab-item" onclick="showScreen('friends')">
            <i class="fas fa-users"></i>
            <span>Amigos</span>
        </div>
        <div class="tab-item" onclick="showScreen('menu')">
            <i class="fas fa-bars"></i>
            <span>Menu</span>
        </div>
    </div>

    <!-- Toast Notifications Container -->
    <div class="toast-container" id="toastContainer"></div>

    <!-- MODAIS ORIGINAIS (mantidos da versão anterior) -->
    
    <!-- Deposit Modal -->
    <div id="depositModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2><i class="fas fa-credit-card"></i> Realizar Depósito</h2>
                <button class="close-modal" onclick="closeModal('depositModal')">&times;</button>
            </div>
            
            <div id="depositStep1">
                <div class="form-group">
                    <label for="depositAmount">Valor do Depósito (Kz)</label>
                    <input type="number" class="form-control" id="depositAmount" min="3000" placeholder="Mínimo: 3.000 Kz" required>
                </div>
                
                <h3 style="margin: 20px 0 15px 0; font-size: 1.1rem;">Escolha o Método de Pagamento</h3>
                
                <div class="method-selector">
                    <div class="method-option" onclick="selectDepositMethod('BFA')" id="methodBFA">
                        <i class="fas fa-university"></i>
                        <h4>Transferência </h4>
                        <p>Transferência bancária</p>
                    </div>
                    
                    <div class="method-option" onclick="selectDepositMethod('REF')" id="methodREF">
                        <i class="fas fa-qrcode"></i>
                        <h4>Referência Multicaixa</h4>
                        <p>Pagamento por referência</p>
                    </div>
                </div>
                
                <!-- BFA Details -->
                <div class="method-details" id="bfaDetails">
                    <div style="background: rgba(255,255,255,0.05); padding: 15px; border-radius: 12px; margin-bottom: 15px;">
                        <h4 style="margin-bottom: 10px; color: #4caf50;"><i class="fas fa-university"></i> Dados para Transferência BFA</h4>
                        <p style="margin: 8px 0; font-size: 0.9rem;"><strong>Conta:</strong> 0006.0000.1473.2043.3014.6</p>
                        <p style="margin: 8px 0; font-size: 0.9rem;"><strong>Titular:</strong>  Stela Afonso Gomes</p>
                        <p style="margin: 8px 0; font-size: 0.9rem; color: var(--gray-light);">
                            <i class="fas fa-info-circle"></i> Use o valor exato do depósito como descrição
                        </p>
                    </div>
                </div>
                
                <!-- Reference Details -->
                <div class="method-details" id="refDetails">
                    <div style="background: rgba(255,255,255,0.05); padding: 15px; border-radius: 12px; margin-bottom: 15px;">
                        <h4 style="margin-bottom: 10px; color: #2196f3;"><i class="fas fa-qrcode"></i> Dados para Referência</h4>
                        <p style="margin: 8px 0; font-size: 0.9rem;"><strong>Entidade:</strong> 00930</p>
                        <p style="margin: 8px 0; font-size: 0.9rem;"><strong>Referência:</strong> 948623398</p>
                        <p style="margin: 8px 0; font-size: 0.9rem; color: var(--gray-light);">
                            <i class="fas fa-info-circle"></i> Insira o valor exato no Multicaixa Express
                        </p>
                    </div>
                </div>
                
                <button class="btn btn-warning" onclick="nextDepositStep(2)" id="nextDepositBtn" disabled>
                    <i class="fas fa-arrow-right"></i> Continuar
                </button>
            </div>
            
            <div id="depositStep2" style="display: none;">
                <h3 style="margin-bottom: 20px; font-size: 1.1rem;"><i class="fas fa-file-upload"></i> Enviar Comprovativo</h3>
                
                <div class="form-group">
                    <label for="depositProof">Foto do Comprovativo</label>
                    <input type="file" class="form-control" id="depositProof" accept="image/*" required>
                    <small style="color: var(--gray-light); font-size: 0.85rem; display: block; margin-top: 8px;">
                        Tire uma foto nítida do comprovativo de pagamento
                    </small>
                </div>
                
                <div class="form-group">
                    <label for="depositNotes">Observações (Opcional)</label>
                    <textarea class="form-control" id="depositNotes" rows="3" placeholder="Alguma informação adicional..."></textarea>
                </div>
                
                <div style="display: flex; gap: 12px; margin-top: 25px;">
                    <button class="btn btn-outline" onclick="nextDepositStep(1)" style="flex: 1;">
                        <i class="fas fa-arrow-left"></i> Voltar
                    </button>
                    <button class="btn btn-success" onclick="submitDeposit()" style="flex: 1;">
                        <i class="fas fa-paper-plane"></i> Enviar
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Withdrawal Modal -->
    <div id="withdrawalModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2><i class="fas fa-money-check-alt"></i> Solicitar Levantamento</h2>
                <button class="close-modal" onclick="closeModal('withdrawalModal')">&times;</button>
            </div>
            
            <div id="bankAccountsContainer" class="bank-accounts-list">
                <!-- Bank accounts will be loaded here -->
            </div>
            
            <form id="withdrawalForm" onsubmit="submitWithdrawal(event)" style="display: none;">
                <div class="form-group">
                    <label for="withdrawAmount">Valor a Levantar (Kz)</label>
                    <input type="number" class="form-control" id="withdrawAmount" min="1000" required oninput="calculateNetAmount()">
                    <small style="color: var(--gray-light); font-size: 0.85rem; display: block; margin-top: 8px;">
                        Taxa de 20% aplicada. Líquido: <span id="netAmount" style="color: var(--success); font-weight: 600;">0 Kz</span>
                    </small>
                </div>
                
                <div class="form-group">
                    <label for="withdrawSchedule">Prazo de Processamento</label>
                    <select class="form-control" id="withdrawSchedule" required>
                        <option value="2h">2 horas (taxa adicional 5%)</option>
                        <option value="10h">10 horas</option>
                        <option value="24h" selected>24 horas</option>
                    </select>
                </div>
                
                <div style="background: rgba(255, 152, 0, 0.15); border-left: 4px solid var(--warning); padding: 16px; border-radius: 12px; margin: 20px 0;">
                    <p style="font-size: 0.9rem; color: var(--gray-light);">
                        <i class="fas fa-exclamation-triangle" style="color: var(--warning);"></i>
                        Levantamentos solicitados na Sexta-feira serão processados na Segunda-feira de manhã.
                    </p>
                </div>
                
                <div style="display: flex; gap: 12px;">
                    <button type="button" class="btn btn-outline" onclick="openModal('withdrawalHistoryModal')" style="flex: 1;">
                        <i class="fas fa-history"></i> Ver Histórico
                    </button>
                    <button type="submit" class="btn btn-success" style="flex: 1;">
                        <i class="fas fa-check-circle"></i> Confirmar
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- History Modal -->
    <div id="withdrawalHistoryModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2><i class="fas fa-history"></i> Histórico de Transações</h2>
                <button class="close-modal" onclick="closeModal('withdrawalHistoryModal')">&times;</button>
            </div>
            
            <div class="history-tabs">
                <div class="history-tab active" onclick="changeHistoryTab('all', this)">
                    <i class="fas fa-list"></i> Todas
                </div>
                <div class="history-tab" onclick="changeHistoryTab('deposits', this)">
                    <i class="fas fa-credit-card"></i> Depósitos
                </div>
                <div class="history-tab" onclick="changeHistoryTab('withdrawals', this)">
                    <i class="fas fa-money-check-alt"></i> Saques
                </div>
            </div>
            
            <div class="history-list" id="historyList">
                <div class="loading">
                    <div class="loading-spinner"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Investment Modal -->
    <div id="investmentModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2><i class="fas fa-chart-line"></i> Planos de Investimento</h2>
                <button class="close-modal" onclick="closeModal('investmentModal')">&times;</button>
            </div>
            
            <div class="contact-support-warning">
                <p>
                    <i class="fas fa-exclamation-triangle"></i>
                    <strong>Atenção:</strong> Você só pode ter um investimento ativo. Para alterar seu plano, entre em contacto com o suporte.
                </p>
            </div>
            
            <div style="background: rgba(0, 200, 83, 0.15); border-left: 4px solid var(--success); padding: 16px; border-radius: 12px; margin-bottom: 20px;">
                <p style="font-size: 0.95rem;">
                    <i class="fas fa-info-circle" style="color: var(--success);"></i>
                    Retornos diários creditados automaticamente a cada 24h (às 00:00)
                </p>
            </div>
            
            <div class="plans-container">
                <div class="plans-grid" id="plansContainer">
                    <!-- Plans will be loaded dynamically -->
                </div>
            </div>
            
            <div id="selectedPlanDetails" style="display: none; margin-top: 25px; padding: 22px; background: rgba(255,255,255,0.05); border-radius: 18px; border: 1px solid rgba(255,255,255,0.1);">
                <h3 style="margin-bottom: 15px; font-size: 1.1rem;"><i class="fas fa-check-circle" style="color: var(--success);"></i> Confirmar Investimento</h3>
                <div id="planDetailsContent"></div>
                
                <div style="background: rgba(255, 152, 0, 0.15); border-left: 4px solid var(--warning); padding: 16px; border-radius: 12px; margin: 15px 0;">
                    <p style="font-size: 0.9rem; color: var(--gray-light);">
                        <i class="fas fa-exclamation-triangle" style="color: var(--warning);"></i>
                        Após confirmação, o valor será debitado do seu saldo e o plano será ativado imediatamente.
                    </p>
                </div>
                
                <button class="btn btn-success" onclick="confirmInvestment()" style="margin-top: 10px;">
                    <i class="fas fa-lock"></i> Confirmar e Investir
                </button>
            </div>
        </div>
    </div>

    <!-- Cancel Contract Modal -->
    <div id="cancelModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2><i class="fas fa-ban"></i> Cancelar Contrato</h2>
                <button class="close-modal" onclick="closeModal('cancelModal')">&times;</button>
            </div>
            
            <form id="cancelForm" onsubmit="submitCancelRequest(event)">
                <div class="form-group">
                    <label for="cancelReason">Motivo do Cancelamento</label>
                    <textarea class="form-control" id="cancelReason" rows="4" required placeholder="Digite o motivo pelo qual deseja cancelar o contrato..."></textarea>
                </div>
                
                <div class="form-group">
                    <label for="currentInvestment">Valor Total Investido (Kz)</label>
                    <input type="number" class="form-control" id="currentInvestment" required>
                </div>
                
                <div class="form-group">
                    <label for="cancelPhone">Número de Telefone para Contacto</label>
                    <input type="tel" class="form-control" id="cancelPhone" required placeholder="9XX XXX XXX">
                </div>
                
                <div style="background: rgba(33, 150, 243, 0.15); border-left: 4px solid var(--info); padding: 16px; border-radius: 12px; margin: 20px 0;">
                    <p style="font-size: 0.95rem; color: var(--gray-light);">
                        <i class="fas fa-info-circle" style="color: var(--info);"></i>
                        Sua solicitação será analisada por nossa equipe. Após aprovação, você receberá o valor total investido de volta no seu saldo.
                    </p>
                </div>
                
                <button type="submit" class="btn btn-danger">
                    <i class="fas fa-paper-plane"></i> Enviar Solicitação
                </button>
            </form>
        </div>
    </div>

    <!-- Profile Modal -->
    <div id="profileModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2><i class="fas fa-user-circle"></i> Meu Perfil</h2>
                <button class="close-modal" onclick="closeModal('profileModal')">&times;</button>
            </div>
            
            <div style="text-align: center; margin: 20px 0;">
                <div style="width: 90px; height: 90px; background: var(--gradient-warning); border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 20px;">
                    <i class="fas fa-user" style="font-size: 2.5rem; color: white;"></i>
                </div>
                <h2 id="profileName" style="font-size: 1.4rem; margin-bottom: 8px; font-weight: 700;">---</h2>
                <p id="profilePhone" style="color: var(--gray-light); font-size: 0.95rem;">---</p>
            </div>
            
            <div style="background: rgba(255,255,255,0.05); border-radius: 18px; padding: 22px; margin: 25px 0; border: 1px solid rgba(255,255,255,0.1);">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; padding-bottom: 20px; border-bottom: 1px solid rgba(255,255,255,0.1);">
                    <div>
                        <div style="font-size: 0.9rem; color: var(--gray-light);">Código de Agente</div>
                        <div style="font-weight: 800; font-size: 1.2rem;" id="profileAgentCode">---</div>
                    </div>
                    <button class="copy-btn" onclick="copyAgentCode()" style="padding: 8px 16px; font-size: 0.85rem;">
                        <i class="far fa-copy"></i> Copiar
                    </button>
                </div>
                
                <div style="margin-bottom: 20px; padding-bottom: 20px; border-bottom: 1px solid rgba(255,255,255,0.1);">
                    <div style="font-size: 0.9rem; color: var(--gray-light);">Data de Registro</div>
                    <div style="font-weight: 700; font-size: 1.1rem;" id="profileDate">---</div>
                </div>
                
                <div style="margin-bottom: 20px; padding-bottom: 20px; border-bottom: 1px solid rgba(255,255,255,0.1);">
                    <div style="font-size: 0.9rem; color: var(--gray-light);">Total Investido</div>
                    <div style="font-weight: 700; font-size: 1.1rem; color: var(--success);" id="profileTotalInvested">0 Kz</div>
                </div>
                
                <div>
                    <div style="font-size: 0.9rem; color: var(--gray-light);">Status da Conta</div>
                    <div style="font-weight: 700; font-size: 1.1rem; color: var(--success);">
                        <i class="fas fa-check-circle"></i> Ativa
                    </div>
                </div>
            </div>
            
            <button class="btn btn-outline" onclick="closeModal('profileModal')">
                <i class="fas fa-times"></i> Fechar
            </button>
        </div>
    </div>

    <!-- Subsidies Modal -->
    <div id="subsidiesModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2><i class="fas fa-gift"></i> Histórico de Subsídios</h2>
                <button class="close-modal" onclick="closeModal('subsidiesModal')">&times;</button>
            </div>
            
            <div style="background: rgba(255, 193, 7, 0.15); border-left: 4px solid #ffc107; padding: 16px; border-radius: 12px; margin-bottom: 20px;">
                <p style="font-size: 0.95rem;">
                    <i class="fas fa-info-circle" style="color: #ffc107;"></i>
                    Subsídios de 8% semanais sobre o valor investido. Pagamentos automáticos todas as segundas-feiras.
                </p>
            </div>
            
            <div class="history-list" id="subsidiesHistoryList">
                <div class="loading">
                    <div class="loading-spinner"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- IBAN Modal -->
    <div id="ibanModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2><i class="fas fa-university"></i> Gerir Contas Bancárias</h2>
                <button class="close-modal" onclick="closeModal('ibanModal')">&times;</button>
            </div>
            
            <div class="bank-accounts-list" id="existingBankAccounts">
                <!-- Existing bank accounts will be loaded here -->
            </div>
            
            <div class="contact-support-warning">
                <p>
                    <i class="fas fa-exclamation-triangle"></i>
                    <strong>Atenção:</strong> Para alterar dados de uma conta já cadastrada, entre em contacto com o suporte. Você pode adicionar novas contas abaixo.
                </p>
            </div>
            
            <h3 style="margin: 25px 0 15px 0; font-size: 1.1rem;">Adicionar Nova Conta</h3>
            
            <form id="ibanForm" onsubmit="addBankAccount(event)">
                <div class="form-group">
                    <label for="accountName">Nome Completo (como no banco)</label>
                    <input type="text" class="form-control" id="accountName" required>
                </div>
                
                <div class="form-group">
                    <label for="ibanNumber">Número IBAN</label>
                    <input type="text" class="form-control" id="ibanNumber" required placeholder="AO06 0000 0000 0000 0000 0000">
                </div>
                
                <div class="form-group">
                    <label for="bankName">Nome do Banco</label>
                    <select class="form-control" id="bankName" required onchange="checkExistingBankAccount(this.value)">
                        <option value="">Selecione o banco...</option>
                        <option value="BFA">Banco de Fomento Angola (BFA)</option>
                        <option value="BAI">Banco Angolano de Investimentos (BAI)</option>
                        <option value="BIC">Banco BIC</option>
                        <option value="ATLANTICO">Banco Atlântico</option>
                        <option value="SOL">Banco Sol</option>
                        <option value="KEVE">Banco Keve</option>
                        <option value="OUTRO">Outro Banco</option>
                    </select>
                </div>
                
                <button type="submit" class="btn btn-success">
                    <i class="fas fa-plus-circle"></i> Adicionar Conta
                </button>
            </form>
        </div>
    </div>

    <!-- About Modal -->
    <div id="aboutModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2><i class="fas fa-info-circle"></i> Sobre a Plataforma</h2>
                <button class="close-modal" onclick="closeModal('aboutModal')">&times;</button>
            </div>
            
            <div style="line-height: 1.6;">
                <div style="background: rgba(26, 35, 126, 0.15); border-radius: 14px; padding: 22px; margin-bottom: 20px; border: 1px solid rgba(26, 35, 126, 0.3);">
                    <h3 style="margin-bottom: 12px; font-size: 1.1rem;"><i class="fas fa-rocket"></i> O que é?</h3>
                    <p style="font-size: 0.95rem; color: var(--gray-light); line-height: 1.6;">
                        Plataforma especializada em instrumentos financeiros com foco em rentabilidade segura e transparente.
                    </p>
                </div>
                
                <div style="background: rgba(0, 200, 83, 0.15); border-radius: 14px; padding: 22px; margin-bottom: 20px; border: 1px solid rgba(0, 200, 83, 0.3);">
                    <h3 style="margin-bottom: 12px; font-size: 1.1rem;"><i class="fas fa-calculator"></i> Nzila Hub</h3>
                    <p style="font-size: 0.95rem; color: var(--gray-light); line-height: 1.6;">
                        Análise completa de ROI, TIR e fluxos de caixa para maximizar seus investimentos.
                    </p>
                </div>
                
                <div style="background: rgba(156, 39, 176, 0.15); border-radius: 14px; padding: 22px; margin-bottom: 20px; border: 1px solid rgba(156, 39, 176, 0.3);">
                    <h3 style="margin-bottom: 12px; font-size: 1.1rem;"><i class="fas fa-shield-alt"></i> Segurança</h3>
                    <p style="font-size: 0.95rem; color: var(--gray-light); line-height: 1.6;">
                        Sistema fechado por convites com direito a cancelamento e retorno do capital.
                    </p>
                </div>
                
                <div style="background: rgba(33, 150, 243, 0.15); border-radius: 14px; padding: 22px; margin-bottom: 20px; border: 1px solid rgba(33, 150, 243, 0.3);">
                    <h3 style="margin-bottom: 12px; font-size: 1.1rem;"><i class="fab fa-telegram"></i> Suporte</h3>
                    <p style="font-size: 0.95rem; color: var(--gray-light); line-height: 1.6;">
                        Suporte 24/7 via Telegram para todas as suas dúvidas e necessidades.
                    </p>
                </div>
            </div>
            
            <button class="btn btn-outline" onclick="closeModal('aboutModal')" style="margin-top: 20px;">
                <i class="fas fa-times"></i> Fechar
            </button>
        </div>
    </div>

    <!-- NOVOS MODAIS -->
    
    <!-- Analytics Modal -->
    <div id="analyticsModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2><i class="fas fa-chart-bar"></i> Analytics</h2>
                <button class="close-modal" onclick="closeModal('analyticsModal')">&times;</button>
            </div>
            
            <div style="background: rgba(33, 150, 243, 0.15); border-left: 4px solid var(--info); padding: 16px; border-radius: 12px; margin-bottom: 20px;">
                <p style="font-size: 0.95rem;">
                    <i class="fas fa-info-circle" style="color: var(--info);"></i>
                    Análise completa do seu crescimento financeiro com projeções futuras.
                </p>
            </div>
            
            <div class="chart-container">
                <canvas id="growthChart" style="width: 100%; height: 250px;"></canvas>
            </div>
            
            <div class="stat-card" style="margin: 20px 0;">
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <div>
                        <div style="font-size: 0.9rem; color: var(--gray-light);">Crescimento Mensal</div>
                        <div style="font-weight: 800; font-size: 1.2rem; color: var(--success);" id="monthlyGrowth">0%</div>
                    </div>
                    <div>
                        <div style="font-size: 0.9rem; color: var(--gray-light);">Projeção Anual</div>
                        <div style="font-weight: 800; font-size: 1.2rem; color: var(--warning);" id="annualProjection">0 Kz</div>
                    </div>
                </div>
            </div>
            
            <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; margin: 20px 0;">
                <div style="background: rgba(255,255,255,0.05); border-radius: 12px; padding: 15px; text-align: center;">
                    <div style="font-size: 0.8rem; color: var(--gray-light);">ROI Médio</div>
                    <div style="font-weight: 800; font-size: 1.1rem; color: var(--success);">3.4%</div>
                </div>
                <div style="background: rgba(255,255,255,0.05); border-radius: 12px; padding: 15px; text-align: center;">
                    <div style="font-size: 0.8rem; color: var(--gray-light);">TIR</div>
                    <div style="font-weight: 800; font-size: 1.1rem; color: var(--info);">28%</div>
                </div>
            </div>
            
            <button class="btn btn-outline" onclick="closeModal('analyticsModal')">
                <i class="fas fa-times"></i> Fechar
            </button>
        </div>
    </div>

    <!-- Simulator Modal -->
    <div id="simulatorModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2><i class="fas fa-calculator"></i> Simulador de Investimentos</h2>
                <button class="close-modal" onclick="closeModal('simulatorModal')">&times;</button>
            </div>
            
            <div style="background: rgba(0, 200, 83, 0.15); border-left: 4px solid var(--success); padding: 16px; border-radius: 12px; margin-bottom: 20px;">
                <p style="font-size: 0.95rem;">
                    <i class="fas fa-info-circle" style="color: var(--success);"></i>
                    Simule seus investimentos e veja projeções de ganhos com juros compostos.
                </p>
            </div>
            
            <div class="form-group">
                <label for="simulatorAmount">Valor do Investimento (Kz)</label>
                <div class="simulation-input">
                    <input type="number" id="simulatorAmount" placeholder="Ex: 10000" min="3000" value="10000">
                    <button class="btn btn-primary" onclick="runSimulation()" style="padding: 10px 20px;">
                        <i class="fas fa-play"></i> Simular
                    </button>
                </div>
            </div>
            
            <div class="simulation-results" id="simulationResults" style="display: none;">
                <h4 style="margin-bottom: 15px; font-size: 1rem; color: var(--success);">
                    <i class="fas fa-chart-line"></i> Projeção de Ganhos
                </h4>
                
                <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; margin-bottom: 15px;">
                    <div style="background: rgba(255,255,255,0.05); border-radius: 8px; padding: 10px;">
                        <div style="font-size: 0.8rem; color: var(--gray-light);">Diário</div>
                        <div style="font-weight: 700; font-size: 0.95rem;" id="simDaily">0 Kz</div>
                    </div>
                    <div style="background: rgba(255,255,255,0.05); border-radius: 8px; padding: 10px;">
                        <div style="font-size: 0.8rem; color: var(--gray-light);">Semanal</div>
                        <div style="font-weight: 700; font-size: 0.95rem;" id="simWeekly">0 Kz</div>
                    </div>
                    <div style="background: rgba(255,255,255,0.05); border-radius: 8px; padding: 10px;">
                        <div style="font-size: 0.8rem; color: var(--gray-light);">Mensal</div>
                        <div style="font-weight: 700; font-size: 0.95rem;" id="simMonthly">0 Kz</div>
                    </div>
                    <div style="background: rgba(255,255,255,0.05); border-radius: 8px; padding: 10px;">
                        <div style="font-size: 0.8rem; color: var(--gray-light);">Anual</div>
                        <div style="font-weight: 700; font-size: 0.95rem;" id="simAnnual">0 Kz</div>
                    </div>
                </div>
                
                <div style="margin-top: 15px;">
                    <div style="font-size: 0.9rem; color: var(--gray-light);">Retorno Total em 1 ano (juros compostos):</div>
                    <div style="font-weight: 800; font-size: 1.1rem; color: var(--success);" id="simTotal">0 Kz</div>
                </div>
            </div>
            
            <button class="btn btn-outline" onclick="closeModal('simulatorModal')" style="margin-top: 20px;">
                <i class="fas fa-times"></i> Fechar
            </button>
        </div>
    </div>

    <!-- Goals Modal -->
    <div id="goalsModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2><i class="fas fa-bullseye"></i> Minhas Metas Financeiras</h2>
                <button class="close-modal" onclick="closeModal('goalsModal')">&times;</button>
            </div>
            
            <div style="background: rgba(156, 39, 176, 0.15); border-left: 4px solid #9c27b0; padding: 16px; border-radius: 12px; margin-bottom: 20px;">
                <p style="font-size: 0.95rem;">
                    <i class="fas fa-info-circle" style="color: #9c27b0;"></i>
                    Defina objetivos financeiros e acompanhe seu progresso em tempo real.
                </p>
            </div>
            
            <div id="goalsList">
                <div class="goal-card">
                    <div class="goal-header">
                        <div class="goal-title">Meta: Primeiro Carro</div>
                        <div class="goal-amount">500.000 Kz</div>
                    </div>
                    <div class="goal-progress">
                        <div class="goal-progress-text">
                            <span>Progresso</span>
                            <span id="goal1Progress">25%</span>
                        </div>
                        <div class="goal-progress-bar">
                            <div class="goal-progress-fill" style="width: 25%"></div>
                        </div>
                    </div>
                    <div style="font-size: 0.85rem; color: var(--gray-light); margin-top: 10px;">
                        <i class="fas fa-calendar"></i> Previsão: 6 meses
                    </div>
                </div>
                
                <div class="goal-card">
                    <div class="goal-header">
                        <div class="goal-title">Meta: Entrada Casa</div>
                        <div class="goal-amount">1.500.000 Kz</div>
                    </div>
                    <div class="goal-progress">
                        <div class="goal-progress-text">
                            <span>Progresso</span>
                            <span id="goal2Progress">15%</span>
                        </div>
                        <div class="goal-progress-bar">
                            <div class="goal-progress-fill" style="width: 15%"></div>
                        </div>
                    </div>
                    <div style="font-size: 0.85rem; color: var(--gray-light); margin-top: 10px;">
                        <i class="fas fa-calendar"></i> Previsão: 1 ano
                    </div>
                </div>
            </div>
            
            <button class="btn btn-success" onclick="openModal('addGoalModal')" style="margin-top: 20px;">
                <i class="fas fa-plus"></i> Adicionar Nova Meta
            </button>
            
            <button class="btn btn-outline" onclick="closeModal('goalsModal')" style="margin-top: 10px;">
                <i class="fas fa-times"></i> Fechar
            </button>
        </div>
    </div>

    <!-- Achievements Modal -->
    <div id="achievementsModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2><i class="fas fa-trophy"></i> Minhas Conquistas</h2>
                <button class="close-modal" onclick="closeModal('achievementsModal')">&times;</button>
            </div>
            
            <div style="background: rgba(255, 193, 7, 0.15); border-left: 4px solid #ffc107; padding: 16px; border-radius: 12px; margin-bottom: 20px;">
                <p style="font-size: 0.95rem;">
                    <i class="fas fa-info-circle" style="color: #ffc107;"></i>
                    Desbloqueie badges e conquistas ao progredir na plataforma.
                </p>
            </div>
            
            <div id="achievementsList">
                <div class="achievement-card">
                    <div class="achievement-icon">
                        <i class="fas fa-rocket"></i>
                    </div>
                    <div class="achievement-details">
                        <div class="achievement-title">Primeiro Investimento</div>
                        <div class="achievement-desc">Realize seu primeiro investimento na plataforma</div>
                        <div class="achievement-progress">
                            <div class="achievement-progress-bar" style="width: 100%"></div>
                        </div>
                    </div>
                </div>
                
                <div class="achievement-card">
                    <div class="achievement-icon">
                        <i class="fas fa-users"></i>
                    </div>
                    <div class="achievement-details">
                        <div class="achievement-title">Networker</div>
                        <div class="achievement-desc">Convide 5 amigos para a plataforma</div>
                        <div class="achievement-progress">
                            <div class="achievement-progress-bar" style="width: 60%"></div>
                        </div>
                    </div>
                </div>
                
                <div class="achievement-card">
                    <div class="achievement-icon">
                        <i class="fas fa-chart-line"></i>
                    </div>
                    <div class="achievement-details">
                        <div class="achievement-title">Investidor Sênior</div>
                        <div class="achievement-desc">Investa mais de 100.000 Kz no total</div>
                        <div class="achievement-progress">
                            <div class="achievement-progress-bar" style="width: 30%"></div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="stat-card" style="margin-top: 20px;">
                <div style="text-align: center;">
                    <div style="font-size: 2rem; font-weight: 800; color: var(--warning);">3/12</div>
                    <div style="font-size: 0.9rem; color: var(--gray-light);">Conquistas Desbloqueadas</div>
                </div>
            </div>
            
            <button class="btn btn-outline" onclick="closeModal('achievementsModal')" style="margin-top: 20px;">
                <i class="fas fa-times"></i> Fechar
            </button>
        </div>
    </div>

    <!-- Cashback Modal -->
    <div id="cashbackModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2><i class="fas fa-percentage"></i> Programa Cashback</h2>
                <button class="close-modal" onclick="closeModal('cashbackModal')">&times;</button>
            </div>
            
            <div style="background: rgba(76, 175, 80, 0.15); border-left: 4px solid #4caf50; padding: 16px; border-radius: 12px; margin-bottom: 20px;">
                <p style="font-size: 0.95rem;">
                    <i class="fas fa-info-circle" style="color: #4caf50;"></i>
                    Ganhe bônus de cashback em cada novo investimento e em aniversários.
                </p>
            </div>
            
            <div class="stat-card">
                <div style="text-align: center; margin-bottom: 20px;">
                    <div style="font-size: 2.5rem; font-weight: 800; color: var(--success);" id="totalCashback">0 Kz</div>
                    <div style="font-size: 0.9rem; color: var(--gray-light);">Total em Cashback Acumulado</div>
                </div>
                
                <div style="border-top: 1px solid rgba(255,255,255,0.1); padding-top: 20px;">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 15px;">
                        <div>
                            <div style="font-weight: 600; font-size: 0.9rem;">Cashback por Investimento</div>
                            <div style="font-size: 0.85rem; color: var(--gray-light);">0.5% sobre cada investimento</div>
                        </div>
                        <div class="cashback-badge">Ativo</div>
                    </div>
                    
                    <div style="display: flex; justify-content: space-between; margin-bottom: 15px;">
                        <div>
                            <div style="font-weight: 600; font-size: 0.9rem;">Cashback Aniversário</div>
                            <div style="font-size: 0.85rem; color: var(--gray-light);">1% extra no mês do aniversário</div>
                        </div>
                        <div class="cashback-badge">Ativo</div>
                    </div>
                    
                    <div style="display: flex; justify-content: space-between;">
                        <div>
                            <div style="font-weight: 600; font-size: 0.9rem;">Cashback Fidelidade</div>
                            <div style="font-size: 0.85rem; color: var(--gray-light);">Bônus a cada 6 meses ativo</div>
                        </div>
                        <div class="cashback-badge" style="background: var(--warning-gradient);">Em progresso</div>
                    </div>
                </div>
            </div>
            
            <div class="history-list" style="margin: 20px 0;">
                <h3 style="margin-bottom: 15px; font-size: 1rem;">Histórico de Cashback</h3>
                <div class="empty-history" style="padding: 30px;">
                    <i class="fas fa-percentage"></i>
                    <h3 style="font-size: 1rem;">Sem histórico ainda</h3>
                    <p style="font-size: 0.85rem;">Seus cashbacks aparecerão aqui</p>
                </div>
            </div>
            
            <button class="btn btn-outline" onclick="closeModal('cashbackModal')">
                <i class="fas fa-times"></i> Fechar
            </button>
        </div>
    </div>

    <!-- Planner Modal -->
    <div id="plannerModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2><i class="fas fa-calendar-alt"></i> Planejador Financeiro</h2>
                <button class="close-modal" onclick="closeModal('plannerModal')">&times;</button>
            </div>
            
            <div style="background: rgba(33, 150, 243, 0.15); border-left: 4px solid var(--info); padding: 16px; border-radius: 12px; margin-bottom: 20px;">
                <p style="font-size: 0.95rem;">
                    <i class="fas fa-info-circle" style="color: var(--info);"></i>
                    Calendário com todas as datas importantes de pagamentos e vencimentos.
                </p>
            </div>
            
            <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin-bottom: 20px;">
                <div style="background: rgba(0, 200, 83, 0.15); border-radius: 10px; padding: 15px; text-align: center;">
                    <div style="font-size: 1.5rem; font-weight: 800; color: var(--success);" id="nextPaymentDay">--</div>
                    <div style="font-size: 0.8rem; color: var(--gray-light);">Próximo Pagamento</div>
                </div>
                
                <div style="background: rgba(255, 152, 0, 0.15); border-radius: 10px; padding: 15px; text-align: center;">
                    <div style="font-size: 1.5rem; font-weight: 800; color: var(--warning);" id="subsidyDay">Seg</div>
                    <div style="font-size: 0.8rem; color: var(--gray-light);">Subsídio Semanal</div>
                </div>
                
                <div style="background: rgba(156, 39, 176, 0.15); border-radius: 10px; padding: 15px; text-align: center;">
                    <div style="font-size: 1.5rem; font-weight: 800; color: #9c27b0;" id="daysActive">0</div>
                    <div style="font-size: 0.8rem; color: var(--gray-light);">Dias Ativo</div>
                </div>
            </div>
            
            <div class="history-list" style="max-height: 300px;">
                <h3 style="padding: 20px 20px 15px 20px; font-size: 1rem;">Próximos Eventos</h3>
                
                <div class="history-item">
                    <div class="history-info">
                        <div class="history-title">Pagamento Diário</div>
                        <div class="history-details">
                            <span>Todos os dias às 00:00</span>
                        </div>
                    </div>
                    <div class="history-status status-completed">
                        <i class="fas fa-check"></i> Ativo
                    </div>
                </div>
                
                <div class="history-item">
                    <div class="history-info">
                        <div class="history-title">Subsídio Semanal</div>
                        <div class="history-details">
                            <span>Todas as segundas-feiras</span>
                        </div>
                    </div>
                    <div class="history-status status-pending">
                        <i class="fas fa-clock"></i> Aguardando
                    </div>
                </div>
                
                <div class="history-item">
                    <div class="history-info">
                        <div class="history-title">Cashback Mensal</div>
                        <div class="history-details">
                            <span>Primeiro dia de cada mês</span>
                        </div>
                    </div>
                    <div class="history-status status-pending">
                        <i class="fas fa-clock"></i> Aguardando
                    </div>
                </div>
            </div>
            
            <button class="btn btn-outline" onclick="closeModal('plannerModal')" style="margin-top: 20px;">
                <i class="fas fa-times"></i> Fechar
            </button>
        </div>
    </div>

    <!-- News Modal -->
    <div id="newsModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2><i class="fas fa-newspaper"></i> Notícias e Dicas</h2>
                <button class="close-modal" onclick="closeModal('newsModal')">&times;</button>
            </div>
            
            <div style="background: rgba(244, 67, 54, 0.15); border-left: 4px solid var(--danger); padding: 16px; border-radius: 12px; margin-bottom: 20px;">
                <p style="font-size: 0.95rem;">
                    <i class="fas fa-info-circle" style="color: var(--danger);"></i>
                    Fique atualizado com as últimas notícias e dicas de investimento.
                </p>
            </div>
            
            <div class="news-card">
                <div class="news-date">08/01/2026</div>
                <div class="news-title">Novos Planos de Investimento</div>
                <div class="news-content">
                    Foram adicionados novos planos de investimento com retornos ainda mais atrativos. Confira na seção de investimentos.
                </div>
            </div>
            
            <div class="news-card">
                <div class="news-date">10/03/2024</div>
                <div class="news-title">Dica: Diversificação</div>
                <div class="news-content">
                    Nunca invista todo seu capital em um único plano. A diversificação é a chave para reduzir riscos.
                </div>
            </div>
            
            <div class="news-card">
                <div class="news-date">05/03/2024</div>
                <div class="news-title">Sistema de Cashback Ativo</div>
                <div class="news-content">
                    O programa de cashback está ativo! Agora você ganha 0.5% de bônus em cada novo investimento.
                </div>
            </div>
            
            <div class="news-card">
                <div class="news-date">01/03/2024</div>
                <div class="news-title">Atualização da Plataforma</div>
                <div class="news-content">
                    Nova interface lançada com mais funcionalidades e melhor desempenho. Confira as novidades no menu.
                </div>
            </div>
            
            <button class="btn btn-outline" onclick="closeModal('newsModal')" style="margin-top: 20px;">
                <i class="fas fa-times"></i> Fechar
            </button>
        </div>
    </div>

    <!-- Security Modal -->
    <div id="securityModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2><i class="fas fa-shield-alt"></i> Segurança da Conta</h2>
                <button class="close-modal" onclick="closeModal('securityModal')">&times;</button>
            </div>
            
            <div style="background: rgba(26, 35, 126, 0.15); border-left: 4px solid var(--primary); padding: 16px; border-radius: 12px; margin-bottom: 20px;">
                <p style="font-size: 0.95rem;">
                    <i class="fas fa-info-circle" style="color: var(--primary);"></i>
                    Gerencie a segurança da sua conta e veja as sessões ativas.
                </p>
            </div>
            
            <div style="margin-bottom: 25px;">
                <h3 style="margin-bottom: 15px; font-size: 1rem;">Sessões Ativas</h3>
                <div id="sessionsList">
                    <div class="security-session">
                        <div class="session-info">
                            <div class="session-device">Chrome - Windows</div>
                            <div class="session-details">Agora mesmo • IP: 192.168.1.1</div>
                        </div>
                        <div class="session-status session-active">
                            Ativa
                        </div>
                    </div>
                    
                    <div class="security-session">
                        <div class="session-info">
                            <div class="session-device">Mobile - Android</div>
                            <div class="session-details">Hoje 14:30 • IP: 192.168.1.2</div>
                        </div>
                        <div class="session-status session-active">
                            Ativa
                        </div>
                    </div>
                </div>
            </div>
            
            <div style="background: rgba(255,255,255,0.05); border-radius: 12px; padding: 20px; margin-bottom: 20px;">
                <h3 style="margin-bottom: 15px; font-size: 1rem;">Configurações de Segurança</h3>
                
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; padding-bottom: 15px; border-bottom: 1px solid rgba(255,255,255,0.1);">
                    <div>
                        <div style="font-weight: 600; font-size: 0.9rem;">Verificação em Duas Etapas</div>
                        <div style="font-size: 0.85rem; color: var(--gray-light);">Proteção adicional para sua conta</div>
                    </div>
                    <div style="width: 50px; height: 26px; background: var(--success); border-radius: 13px; position: relative;">
                        <div style="position: absolute; right: 3px; top: 3px; width: 20px; height: 20px; background: white; border-radius: 50%;"></div>
                    </div>
                </div>
                
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                    <div>
                        <div style="font-weight: 600; font-size: 0.9rem;">Notificações por Email</div>
                        <div style="font-size: 0.85rem; color: var(--gray-light);">Receba alertas de segurança</div>
                    </div>
                    <div style="width: 50px; height: 26px; background: var(--success); border-radius: 13px; position: relative;">
                        <div style="position: absolute; right: 3px; top: 3px; width: 20px; height: 20px; background: white; border-radius: 50%;"></div>
                    </div>
                </div>
            </div>
            
            <button class="btn btn-warning" onclick="terminateOtherSessions()" style="margin-bottom: 10px;">
                <i class="fas fa-sign-out-alt"></i> Terminar Outras Sessões
            </button>
            
            <button class="btn btn-outline" onclick="closeModal('securityModal')">
                <i class="fas fa-times"></i> Fechar
            </button>
        </div>
    </div>

    <!-- Comparison Modal -->
    <div id="comparisonModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2><i class="fas fa-balance-scale"></i> Comparador de Planos</h2>
                <button class="close-modal" onclick="closeModal('comparisonModal')">&times;</button>
            </div>
            
            <div style="background: rgba(156, 39, 176, 0.15); border-left: 4px solid #9c27b0; padding: 16px; border-radius: 12px; margin-bottom: 20px;">
                <p style="font-size: 0.95rem;">
                    <i class="fas fa-info-circle" style="color: #9c27b0;"></i>
                    Compare os diferentes planos de investimento e escolha o melhor para você.
                </p>
            </div>
            
            <div class="plan-comparison" id="planComparison">
                <div class="comparison-card highlighted">
                    <div class="comparison-title">Plano Básico</div>
                    <div class="comparison-value">3.500 Kz</div>
                    <div style="font-size: 0.9rem; color: var(--success); font-weight: 600;">Diário: 120 Kz</div>
                    <div class="comparison-diff positive">+3.4% ROI</div>
                </div>
                
                <div class="comparison-card">
                    <div class="comparison-title">Plano Intermédio</div>
                    <div class="comparison-value">15.000 Kz</div>
                    <div style="font-size: 0.9rem; color: var(--success); font-weight: 600;">Diário: 900 Kz</div>
                    <div class="comparison-diff positive">+6.0% ROI</div>
                </div>
                
                <div class="comparison-card">
                    <div class="comparison-title">Plano Avançado</div>
                    <div class="comparison-value">75.000 Kz</div>
                    <div style="font-size: 0.9rem; color: var(--success); font-weight: 600;">Diário: 3.000 Kz</div>
                    <div class="comparison-diff positive">+4.0% ROI</div>
                </div>
                
                <div class="comparison-card">
                    <div class="comparison-title">Plano Premium</div>
                    <div class="comparison-value">350.000 Kz</div>
                    <div style="font-size: 0.9rem; color: var(--success); font-weight: 600;">Diário: 15.000 Kz</div>
                    <div class="comparison-diff positive">+4.3% ROI</div>
                </div>
            </div>
            
            <div style="margin: 25px 0;">
                <h3 style="margin-bottom: 15px; font-size: 1rem;">Análise Comparativa</h3>
                <div style="background: rgba(255,255,255,0.05); border-radius: 12px; padding: 20px;">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 12px;">
                        <span style="font-size: 0.9rem; color: var(--gray-light);">Melhor ROI:</span>
                        <span style="font-weight: 600; color: var(--success);">Plano Intermédio (6.0%)</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; margin-bottom: 12px;">
                        <span style="font-size: 0.9rem; color: var(--gray-light);">Melhor Liquidez:</span>
                        <span style="font-weight: 600; color: var(--info);">Plano Básico</span>
                    </div>
                    <div style="display: flex; justify-content: space-between;">
                        <span style="font-size: 0.9rem; color: var(--gray-light);">Recomendado para Iniciantes:</span>
                        <span style="font-weight: 600; color: var(--warning);">Plano Básico</span>
                    </div>
                </div>
            </div>
            
            <button class="btn btn-success" onclick="openModal('investmentModal')">
                <i class="fas fa-chart-line"></i> Investir Agora
            </button>
            
            <button class="btn btn-outline" onclick="closeModal('comparisonModal')" style="margin-top: 10px;">
                <i class="fas fa-times"></i> Fechar
            </button>
        </div>
    </div>

    <!-- Add Goal Modal -->
    <div id="addGoalModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2><i class="fas fa-plus"></i> Adicionar Nova Meta</h2>
                <button class="close-modal" onclick="closeModal('addGoalModal')">&times;</button>
            </div>
            
            <form id="goalForm" onsubmit="addNewGoal(event)">
                <div class="form-group">
                    <label for="goalName">Nome da Meta</label>
                    <input type="text" class="form-control" id="goalName" required placeholder="Ex: Comprar Carro">
                </div>
                
                <div class="form-group">
                    <label for="goalAmount">Valor Alvo (Kz)</label>
                    <input type="number" class="form-control" id="goalAmount" required min="1000" placeholder="Ex: 500000">
                </div>
                
                <div class="form-group">
                    <label for="goalDeadline">Prazo (meses)</label>
                    <input type="number" class="form-control" id="goalDeadline" required min="1" max="60" placeholder="Ex: 12">
                </div>
                
                <div class="form-group">
                    <label for="goalNotes">Observações (Opcional)</label>
                    <textarea class="form-control" id="goalNotes" rows="3" placeholder="Descrição ou detalhes da meta..."></textarea>
                </div>
                
                <button type="submit" class="btn btn-success">
                    <i class="fas fa-check"></i> Criar Meta
                </button>
                
                <button type="button" class="btn btn-outline" onclick="closeModal('addGoalModal')" style="margin-top: 10px;">
                    <i class="fas fa-times"></i> Cancelar
                </button>
            </form>
        </div>
    </div>
</head>
<body>

    <!-- (Seu HTML completo — cabeçalho, telas, modais, elementos com ids — permanece exatamente como você enviou) -->
    <!-- Vou incluir abaixo o mesmo HTML que você forneceu (omiti aqui por brevidade), portanto certifique-se de manter todo o conteúdo anterior. -->

    <!-- Toast container -->
    <div id="toastContainer" style="position:fixed; right:18px; top:18px; z-index:1000;"></div>
    <div id="welcomeNotification" style="display:none; position:fixed; left:18px; bottom:18px; background:rgba(0,0,0,0.6); padding:12px; border-radius:10px;">
        <strong>Bem-vindo!</strong>
        <p style="margin:6px 0 0 0;">Aproveite seu bónus de 200 Kz.</p>
    </div>

    <!-- ============================================================= -->
    <!-- IMPORTANTE: mantenha todo o HTML (modals, ids etc.) que você já colocou -->
    <!-- O script abaixo substitui apenas a parte do banco de dados.     -->
    <!-- ============================================================= -->

    <script type="module">
        // Firebase (modular v9) — Auth + Realtime Database
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
        import {
            getDatabase,
            ref,
            get,
            set,
            update,
            push,
            onValue,
            query,
            orderByChild,
            equalTo,
            limitToFirst,
            runTransaction
        } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-database.js";
        import {
            getAuth,
            onAuthStateChanged,
            signInWithEmailAndPassword,
            createUserWithEmailAndPassword,
            signOut
        } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js";

        // === Substituí apenas a configuração do Firebase pelo seu novo Firebase (blue-a110c) ===
        const firebaseConfig = {
            apiKey: "AIzaSyAhgQ2C7d1rXp9swiACYR1dwgeX7z3n3ew",
            authDomain: "blue-a110c.firebaseapp.com",
            databaseURL: "https://blue-a110c-default-rtdb.firebaseio.com",
            projectId: "blue-a110c",
            storageBucket: "blue-a110c.firebasestorage.app",
            messagingSenderId: "828500064328",
            appId: "1:828500064328:web:8b92e0279789061feec07d"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getDatabase(app);

        // --- Mantive todas as suas variáveis e lógica. Apenas converti as operações Firestore -> Realtime Database ---
        let currentUser = null;
        let userData = null;
        let selectedPlan = null;
        let selectedDepositMethod = null;
        let currentHistoryTab = 'all';
        let selectedBankAccount = null;
        let hasActiveInvestment = false;
        let growthChart = null;
        let userListenerUnsub = null;

        const investmentPlans = [
            
            { amount: 8000, daily: 350, period: "Diário", total: null },
            { amount: 10000, daily: 400, period: "Diário", total: null },
            { amount: 12500, daily: 750, period: "Diário", total: null },
            { amount: 15000, daily: 900, period: "Diário", total: null },
            { amount: 22000, daily: 1250, period: "Diário", total: null },
            { amount: 30000, daily: 1650, period: "Diário", total: null },
            { amount: 50000, daily: 2100, period: "Diário", total: null },
            { amount: 65000, daily: 2550, period: "Diário", total: null },
            { amount: 75000, daily: 3000, period: "Diário", total: null },
            { amount: 99000, daily: 5000, period: "Diário", total: null },
            { amount: 150000, daily: 7500, period: "Diário", total: null },
            { amount: 350000, daily: 15000, period: "Diário", total: null },
            { amount: 500000, daily: 50000, period: "Diário", total: null },
            { amount: 1000000, daily: 100000, period: "Diário", total: null }
        ];

        // Formatting helpers (mantive igual)
        function formatCurrency(value) {
            if (!value && value !== 0) return '0 Kz';
            return new Intl.NumberFormat('pt-AO', {
                style: 'currency',
                currency: 'AOA',
                minimumFractionDigits: 0
            }).format(value).replace('AOA', 'Kz');
        }
        function formatNumber(value) {
            if (!value) return '0';
            return new Intl.NumberFormat('pt-AO').format(value);
        }
        function formatDate(dateString) {
            if (!dateString) return 'Data desconhecida';
            try {
                const date = dateString.toDate ? dateString.toDate() : new Date(dateString);
                return date.toLocaleDateString('pt-AO', {
                    day: '2-digit',
                    month: 'short',
                    hour: '2-digit',
                    minute: '2-digit'
                });
            } catch (e) {
                return 'Data inválida';
            }
        }
        function formatDateOnly(dateString) {
            if (!dateString) return 'Data desconhecida';
            try {
                const date = dateString.toDate ? dateString.toDate() : new Date(dateString);
                return date.toLocaleDateString('pt-AO', {
                    day: '2-digit',
                    month: 'long',
                    year: 'numeric'
                });
            } catch (e) {
                return 'Data inválida';
            }
        }

        // UI helpers (mantive)
        function toggleTheme() {
            const body = document.body;
            const themeToggle = document.getElementById('themeToggle');
            const themeIcon = themeToggle ? themeToggle.querySelector('i') : null;
            if (body.classList.contains('light-mode')) {
                body.classList.remove('light-mode');
                if (themeIcon) themeIcon.className = 'fas fa-moon';
                localStorage.setItem('theme', 'dark');
                showToast('Tema Alterado', 'Modo escuro ativado', 'info');
            } else {
                body.classList.add('light-mode');
                if (themeIcon) themeIcon.className = 'fas fa-sun';
                localStorage.setItem('theme', 'light');
                showToast('Tema Alterado', 'Modo claro ativado', 'info');
            }
        }
        function applySavedTheme() {
            const savedTheme = localStorage.getItem('theme');
            const body = document.body;
            const themeToggle = document.getElementById('themeToggle');
            const themeIcon = themeToggle ? themeToggle.querySelector('i') : null;
            if (savedTheme === 'light') {
                body.classList.add('light-mode');
                if (themeIcon) themeIcon.className = 'fas fa-sun';
            } else {
                body.classList.remove('light-mode');
                if (themeIcon) themeIcon.className = 'fas fa-moon';
            }
        }
        function showToast(title, message, type = 'success') {
            const container = document.getElementById('toastContainer');
            if (!container) return;
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            toast.style.marginBottom = '8px';
            toast.style.background = 'rgba(0,0,0,0.6)';
            toast.style.padding = '10px';
            toast.style.borderRadius = '8px';
            toast.innerHTML = `<strong style="display:block;">${title}</strong><div style="font-size:0.9rem; margin-top:6px;">${message}</div>`;
            container.appendChild(toast);
            setTimeout(()=>{ if (toast.parentElement) toast.remove(); }, 5000);
        }
        function showWelcomeNotification() {
            const welcomeNotification = document.getElementById('welcomeNotification');
            const hasSeenNotification = localStorage.getItem('hasSeenWelcomeNotification');
            if (!hasSeenNotification && welcomeNotification) {
                welcomeNotification.style.display = 'block';
                setTimeout(()=>{ welcomeNotification.style.display='none'; localStorage.setItem('hasSeenWelcomeNotification','true'); }, 10000);
            }
        }
        function joinTelegramGroup() {
            window.open('https://chat.whatsapp.com/FLNMvs683IH3P6UrZUwoY5', '_blank');
            localStorage.setItem('hasSeenWelcomeNotification', 'true');
            const el = document.getElementById('welcomeNotification');
            if (el) el.style.display = 'none';
        }

        // ---------------- RTDB helpers ----------------
        async function getUserOnce(uid) {
            const snap = await get(ref(db, `users/${uid}`));
            return snap.exists() ? snap.val() : null;
        }
        async function updateUserFields(uid, obj) {
            const r = ref(db, `users/${uid}`);
            await update(r, obj);
        }
        async function pushToUserArray(uid, arrayKey, item) {
            const userRef = ref(db, `users/${uid}`);
            const snap = await get(userRef);
            const u = snap.exists() ? snap.val() : {};
            const arr = Array.isArray(u[arrayKey]) ? u[arrayKey] : [];
            arr.push(item);
            await update(userRef, { [arrayKey]: arr });
            return arr;
        }

        // Check ban (RTDB)
        async function checkIfUserBanned(userId) {
            try {
                const snapshot = await get(ref(db, `users/${userId}`));
                if (snapshot.exists()) {
                    const u = snapshot.val();
                    if (u.status === 'banned' || u.isBanned === true) {
                        const banData = {
                            endDate: u.banEndDate || null,
                            reason: u.banReason || 'Violação dos Termos de Serviço',
                            code: u.banCode || '001-BAN'
                        };
                        await signOut(auth);
                        setTimeout(()=> showBannedModal(banData), 500);
                        return true;
                    }
                }
                return false;
            } catch (err) { console.error(err); return false; }
        }
        function showBannedModal(banData) {
            const modal = document.getElementById('bannedModal');
            if (!modal) return;
            const endDate = banData.endDate ? new Date(banData.endDate).toLocaleDateString('pt-AO') : 'Indeterminada';
            const reason = banData.reason || 'Violação dos Termos de Serviço';
            const code = banData.code || '001-BAN';
            document.getElementById('banEndDate').textContent = endDate;
            document.getElementById('banReason').textContent = reason;
            document.getElementById('banCode').textContent = code;
            modal.style.display = 'flex';
            modal.onclick = (e)=>{ if (e.target === modal) return false; };
        }

        // ensure bank consistency (RTDB)
        async function ensureBankDataConsistency() {
            try {
                if (!currentUser || !userData) return;
                if (Array.isArray(userData.bankAccounts) && userData.bankAccounts.length > 0) {
                    const defaultAccount = userData.bankAccounts[0];
                    if (userData.accountName !== defaultAccount.accountName ||
                        userData.iban !== defaultAccount.iban ||
                        userData.bankName !== defaultAccount.bankName) {
                        await updateUserFields(currentUser.uid, {
                            accountName: defaultAccount.accountName,
                            iban: defaultAccount.iban,
                            bankName: defaultAccount.bankName
                        });
                        userData.accountName = defaultAccount.accountName;
                        userData.iban = defaultAccount.iban;
                        userData.bankName = defaultAccount.bankName;
                        console.log('✅ Dados bancários padronizados no RTDB');
                    }
                }
            } catch (err) { console.error(err); }
        }

        // Real-time listener for user's data — this makes dashboard update instantly when DB changes
        function attachUserListener(uid) {
            // detach previous
            if (typeof userListenerUnsub === 'function') {
                try { userListenerUnsub(); } catch(e) {}
                userListenerUnsub = null;
            }
            const userRef = ref(db, `users/${uid}`);
            userListenerUnsub = onValue(userRef, snap => {
                if (snap.exists()) {
                    userData = snap.val();
                    // recompute flags
                    hasActiveInvestment = Array.isArray(userData.investments) && userData.investments.some(inv => inv.status === 'active');
                    // update UI reactively
                    updateUI();
                } else {
                    userData = null;
                }
            }, err => console.error('Listener error:', err));
        }

        // loadUserData (one-time) kept for flows that need immediate read
        async function loadUserData() {
            try {
                if (!currentUser) return;
                const u = await getUserOnce(currentUser.uid);
                if (u) {
                    userData = u;
                    await ensureBankDataConsistency();
                    hasActiveInvestment = Array.isArray(userData.investments) && userData.investments.some(inv => inv.status === 'active');
                    updateBankAccountsInfo();
                } else {
                    showToast('Erro', 'Não foi possível carregar seus dados', 'error');
                }
            } catch (err) {
                console.error('Error loading user data:', err);
                showToast('Erro', 'Falha na conexão com o banco de dados', 'error');
            }
        }

        // The rest of UI functions follow — I preserved your original logic but replaced Firestore calls with RTDB equivalents.
        function updateBankAccountsInfo() {
            if (!userData) return;
            const existingBankAccounts = document.getElementById('existingBankAccounts');
            if (existingBankAccounts && Array.isArray(userData.bankAccounts) && userData.bankAccounts.length > 0) {
                existingBankAccounts.innerHTML = userData.bankAccounts.map((account, index) => `
                    <div class="bank-account-item">
                        <div class="bank-account-info">
                            <h4>${account.bankName} - ${account.accountName}</h4>
                            <p>${account.iban}</p>
                        </div>
                        <div class="bank-account-actions">
                            <button class="select-bank-btn" onclick="selectBankAccountForWithdrawal(${index})">
                                <i class="fas fa-check"></i> Usar
                            </button>
                        </div>
                    </div>
                `).join('');
            } else if (existingBankAccounts) {
                existingBankAccounts.innerHTML = `
                    <div class="empty-history">
                        <i class="fas fa-university"></i>
                        <h3>Nenhuma conta cadastrada</h3>
                        <p>Adicione sua primeira conta bancária abaixo</p>
                    </div>
                `;
            }
        }

        function checkExistingBankAccount(bankName) {
            if (!userData || !userData.bankAccounts) return;
            const existingAccount = userData.bankAccounts.find(acc => acc.bankName === bankName);
            if (existingAccount) {
                showToast('Conta já existe', `Você já tem uma conta ${bankName} cadastrada. Para alterar dados, contacte o suporte.`, 'warning');
                const a = document.getElementById('accountName'); if (a) a.value = '';
                const i = document.getElementById('ibanNumber'); if (i) i.value = '';
            }
        }

        async function addBankAccount(event) {
            event.preventDefault();
            const accountName = document.getElementById('accountName').value;
            const ibanNumber = document.getElementById('ibanNumber').value;
            const bankName = document.getElementById('bankName').value;
            if (!accountName || !ibanNumber || !bankName) {
                showToast('Erro', 'Preencha todos os campos', 'error'); return;
            }
            if (userData && Array.isArray(userData.bankAccounts) && userData.bankAccounts.some(acc => acc.bankName === bankName)) {
                showToast('Erro', `Você já tem uma conta ${bankName} cadastrada. Para alterar dados, contacte o suporte.`, 'error'); return;
            }
            try {
                const newAccount = { accountName, iban: ibanNumber, bankName, addedDate: new Date().toISOString(), isDefault: (!userData || !Array.isArray(userData.bankAccounts) || userData.bankAccounts.length===0) };
                const accounts = Array.isArray(userData?.bankAccounts) ? [...userData.bankAccounts, newAccount] : [newAccount];
                const updateObj = { bankAccounts: accounts };
                if (newAccount.isDefault) { updateObj.accountName = accountName; updateObj.iban = ibanNumber; updateObj.bankName = bankName; }
                await updateUserFields(currentUser.uid, updateObj);
                userData.bankAccounts = accounts;
                if (newAccount.isDefault) { userData.accountName = accountName; userData.iban = ibanNumber; userData.bankName = bankName; }
                showToast('Sucesso!', 'Conta bancária adicionada com sucesso!', 'success');
                const a = document.getElementById('accountName'); if (a) a.value = '';
                const i = document.getElementById('ibanNumber'); if (i) i.value = '';
                const b = document.getElementById('bankName'); if (b) b.value = '';
                updateBankAccountsInfo();
            } catch (err) { console.error(err); showToast('Erro', 'Falha ao adicionar conta: ' + err.message, 'error'); }
        }

        function selectBankAccountForWithdrawal(index) {
            if (!userData || !Array.isArray(userData.bankAccounts) || index >= userData.bankAccounts.length) {
                showToast('Erro', 'Conta bancária não encontrada', 'error'); return;
            }
            selectedBankAccount = userData.bankAccounts[index];
            const bankAccounts = document.querySelectorAll('.bank-account-item');
            bankAccounts.forEach((account, i) => { if (i===index) account.classList.add('selected'); else account.classList.remove('selected'); });
            const wf = document.getElementById('withdrawalForm'); if (wf) wf.style.display = 'block';
            showToast('Conta selecionada', `Você receberá na conta ${selectedBankAccount.bankName}`, 'success');
        }

        function loadBankAccountsForWithdrawal() {
            const container = document.getElementById('bankAccountsContainer');
            if (!container || !userData) return;
            if (Array.isArray(userData.bankAccounts) && userData.bankAccounts.length > 0) {
                container.innerHTML = `
                    <h3 style="margin-bottom: 15px; font-size: 1.1rem;">Selecione a conta para receber</h3>
                    ${userData.bankAccounts.map((account, index) => `
                        <div class="bank-account-item" onclick="selectBankAccountForWithdrawal(${index})">
                            <div class="bank-account-info">
                                <h4>${account.bankName} - ${account.accountName}</h4>
                                <p>${account.iban}</p>
                            </div>
                            <div class="bank-account-actions">
                                <button class="select-bank-btn">
                                    <i class="fas fa-check"></i> Selecionar
                                </button>
                            </div>
                        </div>
                    `).join('')}
                `;
            } else {
                container.innerHTML = `
                    <div class="empty-history">
                        <i class="fas fa-university"></i>
                        <h3>Nenhuma conta cadastrada</h3>
                        <p>Adicione uma conta bancária primeiro</p>
                        <button class="btn btn-outline" onclick="openModal('ibanModal')" style="margin-top: 15px;">
                            <i class="fas fa-plus"></i> Adicionar Conta
                        </button>
                    </div>
                `;
            }
        }

        async function updateUI() {
            if (!userData) return;
            const balance = userData.balance || 0;
            const invested = calculateTotalInvested();
            const dailyEarnings = calculateDailyEarnings();
            const elBalance = document.getElementById('balanceAmount'); if (elBalance) elBalance.textContent = formatCurrency(balance);
            const elInvested = document.getElementById('investedAmount'); if (elInvested) elInvested.textContent = formatCurrency(invested);
            const elDaily = document.getElementById('dailyEarningsAmount'); if (elDaily) elDaily.textContent = formatCurrency(dailyEarnings);

            const agentNumberEl = document.getElementById('agentNumber'); const agentCodeDisplay = document.getElementById('agentCodeDisplay');
            if (agentNumberEl) agentNumberEl.textContent = userData.phone ? userData.phone.substring(0,3)+'***'+userData.phone.substring(6) : '---';
            if (agentCodeDisplay) agentCodeDisplay.textContent = userData.agentCode || '---';
            const profileName = document.getElementById('profileName'); if (profileName) profileName.textContent = userData.fullName || '---';
            const profilePhone = document.getElementById('profilePhone'); if (profilePhone) profilePhone.textContent = userData.phone || '---';
            const profileAgentCode = document.getElementById('profileAgentCode'); if (profileAgentCode) profileAgentCode.textContent = userData.agentCode || '---';
            const profileTotalInvested = document.getElementById('profileTotalInvested'); if (profileTotalInvested) profileTotalInvested.textContent = formatCurrency(invested);
            const profileDate = document.getElementById('profileDate'); if (profileDate && userData.createdAt) profileDate.textContent = formatDate(userData.createdAt);

            const inviteLink = `${window.location.origin}/signup.html?ref=${userData.agentCode}`; const inviteLinkText = document.getElementById('inviteLinkText'); if (inviteLinkText) inviteLinkText.textContent = inviteLink;

            await loadFriendsStats();
            await loadReferralsList();

            const cashbackTotal = userData.cashback || 0; const totalCashback = document.getElementById('totalCashback'); if (totalCashback) totalCashback.textContent = formatCurrency(cashbackTotal);
        }

        function calculateTotalInvested() {
            if (!userData || !Array.isArray(userData.investments)) return 0;
            return userData.investments.reduce((sum, inv) => sum + (inv.planAmount || 0), 0);
        }
        function calculateDailyEarnings() {
            if (!userData || !Array.isArray(userData.investments)) return 0;
            const activeInvestment = userData.investments.find(inv => inv.status === 'active');
            if (!activeInvestment) return 0;
            return activeInvestment.dailyReturn || 0;
        }

        async function loadFriendsStats() {
            if (!userData || !userData.agentCode) return;
            try {
                const q = query(ref(db, 'users'), orderByChild('referredBy'), equalTo(userData.agentCode));
                const snap = await get(q);
                let registeredCount = 0, investedCount = 0;
                if (snap.exists()) {
                    snap.forEach(child => {
                        registeredCount++;
                        const u = child.val();
                        if (u.hasInvestedBefore || (Array.isArray(u.investments) && u.investments.length>0)) investedCount++;
                    });
                }
                const totalCommission = userData.earnings?.commission || 0;
                const investedFriendsEl = document.getElementById('investedFriends'); if (investedFriendsEl) investedFriendsEl.textContent = investedCount;
                const registeredFriendsEl = document.getElementById('registeredFriends'); if (registeredFriendsEl) registeredFriendsEl.textContent = registeredCount;
                const totalCommissionEl = document.getElementById('totalCommission'); if (totalCommissionEl) totalCommissionEl.textContent = formatCurrency(totalCommission);
                const activeInvestmentsEl = document.getElementById('activeInvestments'); if (activeInvestmentsEl) activeInvestmentsEl.textContent = Array.isArray(userData.investments)? userData.investments.filter(inv=>inv.status==='active').length : 0;
            } catch (err) { console.error(err); }
        }

        async function loadReferralsList() {
            const container = document.getElementById('referralsList');
            if (!container || !userData || !userData.agentCode) return;
            try {
                const q = query(ref(db,'users'), orderByChild('referredBy'), equalTo(userData.agentCode));
                const snap = await get(q);
                if (!snap.exists()) {
                    container.innerHTML = `<div class="empty-history"><i class="fas fa-user-friends"></i><h3>Nenhum referido ainda</h3><p>Compartilhe seu link de convite para ganhar comissões</p></div>`;
                    return;
                }
                const referrals = [];
                snap.forEach(child => {
                    const u = child.val();
                    referrals.push({
                        name: u.fullName||'Usuário',
                        phone: u.phone||'',
                        agentCode: u.agentCode||'',
                        hasInvested: u.hasInvestedBefore || (Array.isArray(u.investments)&&u.investments.length>0),
                        registeredDate: u.createdAt || new Date().toISOString(),
                        investmentAmount: Array.isArray(u.investments)&&u.investments.length>0 ? (u.investments[0].planAmount||0) : 0
                    });
                });
                container.innerHTML = referrals.map(ref => `
                    <div class="history-item">
                        <div class="history-info">
                            <div class="history-title">${ref.name}</div>
                            <div class="history-details">
                                <span>${ref.phone}</span>
                                <span>Agente: ${ref.agentCode}</span>
                                <span>${formatDateOnly(ref.registeredDate)}</span>
                            </div>
                        </div>
                        <div class="history-status ${ref.hasInvested ? 'status-approved' : 'status-pending'}">
                            ${ref.hasInvested ? 'Investiu ' + formatCurrency(ref.investmentAmount) : 'Não investiu'}
                        </div>
                    </div>
                `).join('');
            } catch (err) { console.error(err); container.innerHTML = `<div class="empty-history"><i class="fas fa-exclamation-triangle"></i><h3>Erro ao carregar referidos</h3><p>Tente novamente mais tarde</p></div>`; }
        }

        // checkDailyEarnings adapted to RTDB using transaction
        async function checkDailyEarnings() {
            if (!userData || !Array.isArray(userData.investments)) return;
            const activeInvestment = userData.investments.find(inv => inv.status === 'active');
            if (!activeInvestment) return;
            const now = new Date();
            const lastCredit = activeInvestment.lastDailyCredit ? new Date(activeInvestment.lastDailyCredit) : new Date(activeInvestment.startDate || Date.now());
            const nowMidnight = new Date(now.getFullYear(), now.getMonth(), now.getDate());
            const lastCreditMidnight = new Date(lastCredit.getFullYear(), lastCredit.getMonth(), lastCredit.getDate());
            if (nowMidnight > lastCreditMidnight) {
                try {
                    const dailyEarning = activeInvestment.dailyReturn || 0;
                    const cashbackAmount = dailyEarning * 0.005;
                    const userRef = ref(db, `users/${currentUser.uid}`);
                    await runTransaction(userRef, current => {
                        if (current) {
                            current.balance = (current.balance || 0) + dailyEarning;
                            current.cashback = (current.cashback || 0) + cashbackAmount;
                            if (!Array.isArray(current.investments)) current.investments = [];
                            for (let i=0;i<current.investments.length;i++){
                                if (current.investments[i].id === activeInvestment.id){
                                    current.investments[i].lastDailyCredit = now.toISOString();
                                    current.investments[i].totalEarned = (current.investments[i].totalEarned || 0) + dailyEarning;
                                    break;
                                }
                            }
                            if (!Array.isArray(current.dailyEarnings)) current.dailyEarnings = [];
                            current.dailyEarnings.push({ amount: dailyEarning, cashback: cashbackAmount, date: now.toISOString(), investmentId: activeInvestment.id, type:'daily_earning' });
                        }
                        return current;
                    });
                    const fresh = await getUserOnce(currentUser.uid); if (fresh) userData = fresh;
                    showToast('Ganho Diário Creditado!', `Você recebeu ${formatCurrency(dailyEarning)} (+ ${formatCurrency(cashbackAmount)} cashback)`, 'success');
                    updateUI();
                } catch (err) { console.error(err); setTimeout(checkDailyEarnings, 5000); }
            }
        }

        // processReferralCommission adapted to RTDB
        async function processReferralCommission(referredUserId, investmentAmount) {
            if (!userData || !userData.agentCode) return;
            try {
                const referredSnap = await get(ref(db, `users/${referredUserId}`));
                const referredUserData = referredSnap.exists() ? referredSnap.val() : null;
                const hasPaidCommission = Array.isArray(userData.commissions) && userData.commissions.some(comm=>comm.fromUserId===referredUserId);
                if (referredUserData && !hasPaidCommission) {
                    const commissionAmount = investmentAmount * 0.15;
                    const userRef = ref(db, `users/${currentUser.uid}`);
                    await runTransaction(userRef, current => {
                        if (current) {
                            current.balance = (current.balance || 0) + commissionAmount;
                            if (!current.earnings) current.earnings = {};
                            current.earnings.commission = (current.earnings.commission || 0) + commissionAmount;
                            if (!Array.isArray(current.commissions)) current.commissions = [];
                            current.commissions.push({ amount: commissionAmount, date: new Date().toISOString(), fromUserId: referredUserId, fromUserName: referredUserData.fullName || 'Referido', investmentAmount, type:'referral_commission' });
                        }
                        return current;
                    });
                    // add referrerCommissions on referred user
                    const refRef = ref(db, `users/${referredUserId}/referrerCommissions`);
                    const refSnap = await get(refRef);
                    const arr = refSnap.exists() ? refSnap.val() : [];
                    arr.push(currentUser.uid);
                    await set(refRef, arr);
                    const fresh = await getUserOnce(currentUser.uid); if (fresh) userData = fresh;
                    showToast('Comissão Recebida!', `Você ganhou ${formatCurrency(commissionAmount)} de comissão (15%)`, 'success');
                    updateUI();
                }
            } catch (err) { console.error(err); }
        }

        // The rest of the UI functions (loadActivePlans, loadRecentTransactions, navigation, modals, deposit/withdraw/invest flows)
        // I preserved their logic and replaced Firestore operations with RTDB equivalents where needed.

        function loadActivePlans() {
            const container = document.getElementById('activePlansContainer');
            if (!container || !userData) return;
            const activeInvestments = Array.isArray(userData.investments) ? userData.investments.filter(inv => inv.status === 'active') : [];
            if (activeInvestments.length === 0) {
                container.innerHTML = `<div class="empty-history"><i class="fas fa-chart-line"></i><h3>Nenhum plano ativo</h3><p>Comece a investir para ver seus planos aqui</p><button class="btn btn-success" onclick="openModal('investmentModal')" style="margin-top: 15px;"><i class="fas fa-plus"></i> Investir Agora</button></div>`;
                return;
            }
            const activeInvestment = activeInvestments[0];
            container.innerHTML = `<div class="active-plan-card"><div class="plan-header"><h3 style="font-size: 1.2rem; font-weight: 700;">Plano Ativo</h3><div class="plan-status"><i class="fas fa-check-circle"></i> Ativo</div></div><div class="plan-details"><div class="plan-detail-item"><div class="plan-detail-label">Valor Investido</div><div class="plan-detail-value">${formatCurrency(activeInvestment.planAmount)}</div></div><div class="plan-detail-item"><div class="plan-detail-label">Retorno Diário</div><div class="plan-detail-value" style="color: var(--success); font-weight: 800;">${formatCurrency(activeInvestment.dailyReturn)}</div></div><div class="plan-detail-item"><div class="plan-detail-label">Data de Início</div><div class="plan-detail-value">${formatDateOnly(activeInvestment.startDate)}</div></div><div class="plan-detail-item"><div class="plan-detail-label">Período</div><div class="plan-detail-value">${activeInvestment.period}</div></div></div></div>`;
        }

        async function loadRecentTransactions() {
            const container = document.getElementById('recentTransactions');
            if (!container || !userData) return;
            const transactions = [];
            if (Array.isArray(userData.deposits)) userData.deposits.slice(0,3).forEach(deposit=>transactions.push({type:'deposit', title:`Depósito ${deposit.method||''}`, amount:deposit.amount||0, date:deposit.date?formatDate(deposit.date):'Data desconhecida', status:deposit.status||'pending', timestamp:deposit.timestamp||new Date(deposit.date).getTime()}));
            if (Array.isArray(userData.withdrawals)) userData.withdrawals.slice(0,3).forEach(w=>transactions.push({type:'withdrawal', title:`Levantamento ${w.method||''}`, amount:-(w.amount||0), date:w.date?formatDate(w.date):'Data desconhecida', status:w.status||'pending', timestamp:w.timestamp||new Date(w.date).getTime()}));
            if (Array.isArray(userData.dailyEarnings)) userData.dailyEarnings.slice(0,2).forEach(e=>transactions.push({type:'earning', title:'Ganho Diário', amount:e.amount||0, date:e.date?formatDate(e.date):'Data desconhecida', status:'completed', timestamp:new Date(e.date).getTime()}));
            if (Array.isArray(userData.commissions)) userData.commissions.slice(0,3).forEach(c=>transactions.push({type:'commission', title:`Comissão de ${c.fromUserName||'referido'}`, amount:c.amount||0, date:c.date?formatDate(c.date):'Data desconhecida', status:'completed', timestamp:new Date(c.date).getTime()}));
            transactions.sort((a,b)=> (b.timestamp||0)-(a.timestamp||0));
            const recentTransactions = transactions.slice(0,5);
            if (recentTransactions.length===0) { container.innerHTML = `<div class="empty-history"><i class="fas fa-history"></i><h3>Nenhuma transação recente</h3><p>Realize seu primeiro depósito ou investimento</p></div>`; return; }
            container.innerHTML = recentTransactions.map(transaction=>`<div class="transaction-item"><div class="transaction-info"><div class="transaction-icon ${transaction.type}"><i class="fas fa-${transaction.type==='deposit'?'arrow-down':transaction.type==='withdrawal'?'arrow-up':transaction.type==='earning'?'coins':transaction.type==='commission'?'hand-holding-usd':'gift'}"></i></div><div class="transaction-details"><h4>${transaction.title}</h4><div class="date">${transaction.date}</div></div></div><div class="transaction-amount ${transaction.amount>0?'positive':'negative'}">${transaction.amount>0?'+':''}${formatCurrency(Math.abs(transaction.amount))}</div></div>`).join('');
        }

        function showScreen(screenName) {
            document.querySelectorAll('.screen').forEach(screen=>screen.classList.remove('active'));
            document.querySelectorAll('.tab-item').forEach(tab=>tab.classList.remove('active'));
            const screen = document.getElementById(`${screenName}Screen`);
            if (screen) screen.classList.add('active');
            if (screenName === 'home') { updateUI(); loadRecentTransactions(); }
            else if (screenName === 'friends') { updateUI(); }
            else if (screenName === 'myPlans') { loadActivePlans(); }
            else if (screenName === 'menu') { updateGoalsProgress(); }
        }

        function openModal(modalId) {
            const modal = document.getElementById(modalId); if (!modal) return; modal.style.display='flex';
            switch(modalId){
                case 'investmentModal': loadInvestmentPlans(); break;
                case 'depositModal': resetDepositModal(); break;
                case 'withdrawalModal': loadBankAccountsForWithdrawal(); selectedBankAccount=null; const wf=document.getElementById('withdrawalForm'); if (wf) wf.style.display='none'; break;
                case 'withdrawalHistoryModal': loadHistoryData(); break;
                case 'subsidiesModal': loadSubsidiesData(); break;
                case 'ibanModal': updateBankAccountsInfo(); break;
                case 'analyticsModal': loadAnalyticsData(); break;
                case 'goalsModal': updateGoalsProgress(); break;
                case 'plannerModal': updatePlannerInfo(); break;
            }
        }
        function closeModal(modalId) { const modal=document.getElementById(modalId); if (modal) { modal.style.display='none'; if (modalId!=='addGoalModal') resetModals(); } }
        function resetModals(){ resetDepositModal(); selectedPlan=null; selectedBankAccount=null; const sp=document.getElementById('selectedPlanDetails'); if (sp) sp.style.display='none'; document.querySelectorAll('.plan-card').forEach(c=>c.classList.remove('selected')); document.querySelectorAll('.form-control').forEach(input=>{ if (input.type!=='file') input.value=''; }); }
        function resetDepositModal(){ selectedDepositMethod=null; const s1=document.getElementById('depositStep1'); const s2=document.getElementById('depositStep2'); if (s1) s1.style.display='block'; if (s2) s2.style.display='none'; const next=document.getElementById('nextDepositBtn'); if (next) next.disabled=true; document.querySelectorAll('.method-option').forEach(o=>o.classList.remove('selected')); document.querySelectorAll('.method-details').forEach(d=>d.classList.remove('active')); }

        function changeHistoryTab(tab, element) { currentHistoryTab = tab; document.querySelectorAll('.history-tab').forEach(t=>t.classList.remove('active')); if (element) element.classList.add('active'); loadHistoryData(); }

        async function loadHistoryData() {
            const container = document.getElementById('historyList');
            if (!container || !userData) return;
            container.innerHTML = `<div class="loading"><div class="loading-spinner"></div></div>`;
            const allTransactions = [];
            if (Array.isArray(userData.deposits)) userData.deposits.forEach(deposit => allTransactions.push({type:'deposit', title:`Depósito via ${deposit.method||'BFA'}`, amount:deposit.amount||0, date:deposit.date, status:deposit.status||'pending', method:deposit.method, timestamp:deposit.timestamp||new Date(deposit.date).getTime()}));
            if (Array.isArray(userData.withdrawals)) userData.withdrawals.forEach(w=>allTransactions.push({type:'withdrawal', title:`Levantamento ${w.method||''}`, amount:w.amount||0, netAmount:w.netAmount, date:w.date, status:w.status||'pending', method:w.method, timestamp:w.timestamp||new Date(w.date).getTime()}));
            allTransactions.sort((a,b)=>(b.timestamp||0)-(a.timestamp||0));
            const filtered = currentHistoryTab==='all'? allTransactions : allTransactions.filter(t=> t.type === (currentHistoryTab==='withdrawals' ? 'withdrawal' : currentHistoryTab==='deposits' ? 'deposit' : t.type));
            if (filtered.length===0){ container.innerHTML = `<div class="empty-history"><i class="fas fa-${currentHistoryTab==='withdrawals'?'money-check-alt': currentHistoryTab==='deposits'?'credit-card':'list'}"></i><h3>Nenhum registro encontrado</h3><p>Não há ${currentHistoryTab==='withdrawals'?'levantamentos': currentHistoryTab==='deposits'?'depósitos':'transações'} realizados ainda</p></div>`; return; }
            container.innerHTML = filtered.map(item=>`<div class="history-item"><div class="history-info"><div class="history-title">${item.title}</div><div class="history-details"><span>${item.type==='withdrawal' ? 'Líquido: ' + formatCurrency(item.netAmount || item.amount * 0.8) : formatCurrency(item.amount)}</span><span>${formatDate(item.date)}</span></div></div><div class="history-status status-${item.status==='pending'?'pending': item.status==='approved' || item.status==='completed' ? 'completed': item.status==='active' ? 'approved' : 'rejected'}">${item.status==='pending'?'Pendente': item.status==='approved'?'Aprovado': item.status==='completed'?'Concluído': item.status==='active'?'Ativo':'Rejeitado'}</div></div>`).join('');
        }

        async function loadSubsidiesData() {
            const container = document.getElementById('subsidiesHistoryList'); if (!container) return;
            container.innerHTML = `<div class="loading"><div class="loading-spinner"></div></div>`;
            if (!userData || !userData.earnings || !userData.earnings.subsidies || userData.earnings.subsidies===0) {
                container.innerHTML = `<div class="empty-history"><i class="fas fa-gift"></i><h3>Nenhum subsídio recebido ainda</h3><p>Os subsídios de 8% começam a ser pagos após o primeiro investimento ativo</p></div>`;
                return;
            }
            container.innerHTML = `<div class="empty-history"><i class="fas fa-gift"></i><h3>Total em Subsídios: ${formatCurrency(userData.earnings.subsidies||0)}</h3><p>Subsídios são pagos semanalmente sobre o valor investido</p></div>`;
        }

        function selectDepositMethod(method) {
            selectedDepositMethod = method;
            document.querySelectorAll('.method-option').forEach(option=>option.classList.remove('selected'));
            document.querySelectorAll('.method-details').forEach(details=>details.classList.remove('active'));
            if (method==='BFA') { const el=document.getElementById('methodBFA'); if (el) el.classList.add('selected'); const d=document.getElementById('bfaDetails'); if (d) d.classList.add('active'); }
            else if (method==='REF') { const el=document.getElementById('methodREF'); if (el) el.classList.add('selected'); const d=document.getElementById('refDetails'); if (d) d.classList.add('active'); }
            const amount = document.getElementById('depositAmount') ? document.getElementById('depositAmount').value : null; const next = document.getElementById('nextDepositBtn'); if (next) next.disabled = !(amount && amount>=3000);
        }

        function nextDepositStep(step) {
            const amount = parseFloat(document.getElementById('depositAmount').value);
            if (step===2) {
                if (!amount || amount <3000) { showToast('Valor Inválido','O valor mínimo do depósito é 3.000 Kz','error'); return; }
                if (!selectedDepositMethod) { showToast('Método Não Selecionado','Escolha um método de pagamento','warning'); return; }
                const s1=document.getElementById('depositStep1'); const s2=document.getElementById('depositStep2'); if (s1) s1.style.display='none'; if (s2) s2.style.display='block';
            } else {
                const s1=document.getElementById('depositStep1'); const s2=document.getElementById('depositStep2'); if (s1) s1.style.display='block'; if (s2) s2.style.display='none';
            }
        }

        // submitDeposit (RTDB): push deposit into user's deposits array
        async function submitDeposit() {
            const amount = parseFloat(document.getElementById('depositAmount').value);
            const method = selectedDepositMethod;
            const proofEl = document.getElementById('depositProof');
            const proof = proofEl && proofEl.files ? proofEl.files[0] : null;
            const notes = document.getElementById('depositNotes') ? document.getElementById('depositNotes').value : '';
            if (!amount || amount < 3000) { showToast('Erro','Valor mínimo do depósito é 3.000 Kz','error'); return; }
            if (!method) { showToast('Erro','Selecione um método de pagamento','error'); return; }
            if (!proof) { showToast('Erro','Faça upload do comprovativo','error'); return; }
            try {
                const deposit = { amount, method, status:'pending', date: new Date().toISOString(), notes: notes||'', proofFileName: proof.name, timestamp: Date.now() };
                await pushToUserArray(currentUser.uid, 'deposits', deposit);
                if (!userData.deposits) userData.deposits = [];
                userData.deposits.push(deposit);
                showToast('Sucesso!','Depósito solicitado. Envie o comprovativo para o suporte no Telegram para validação.','success');
                closeModal('depositModal'); loadRecentTransactions();
            } catch (err) { console.error(err); showToast('Erro','Falha ao processar depósito: '+err.message,'error'); }
        }

        function calculateNetAmount() {
            const amount = parseFloat(document.getElementById('withdrawAmount').value) || 0;
            const schedule = document.getElementById('withdrawSchedule').value;
            let netAmount = amount * 0.8;
            if (schedule==='2h') netAmount = amount * 0.75;
            const netEl = document.getElementById('netAmount'); if (netEl) netEl.textContent = formatCurrency(netAmount);
        }

        // submitWithdrawal -> write withdrawal to user's withdrawals array and create adminWithdrawals entry
        async function submitWithdrawal(event) {
            event.preventDefault();
            const amount = parseFloat(document.getElementById('withdrawAmount').value);
            const schedule = document.getElementById('withdrawSchedule').value;
            if (!amount || amount < 1000) { showToast('Erro','Valor mínimo para levantamento é 1.000 Kz','error'); return; }
            if (!selectedBankAccount) { showToast('Erro','Selecione uma conta bancária','error'); return; }
            if (!userData || userData.balance < amount) { showToast('Saldo Insuficiente','Seu saldo é inferior ao valor solicitado','error'); return; }
            try {
                const netAmount = amount * (schedule==='2h' ? 0.75 : 0.8);
                const bankAccountData = { accountName: selectedBankAccount.accountName || userData.accountName || '', iban: selectedBankAccount.iban || userData.iban || '', bankName: selectedBankAccount.bankName || userData.bankName || '' };
                const withdrawal = { amount, netAmount, method: bankAccountData.bankName, schedule, status:'pending', date: new Date().toISOString(), timestamp: Date.now(), fee: schedule==='2h' ? '25%' : '20%', bankAccount: bankAccountData, iban: bankAccountData.iban, bankName: bankAccountData.bankName, accountName: bankAccountData.accountName, userId: currentUser.uid, userPhone: userData.phone||'', userName: userData.fullName||'', agentCode: userData.agentCode||'', userUid: currentUser.uid };
                const newBalance = userData.balance - amount;
                // update user balance & withdrawals via transaction to reduce race conditions
                const userRef = ref(db, `users/${currentUser.uid}`);
                await runTransaction(userRef, current => {
                    if (current) {
                        current.balance = newBalance;
                        if (!Array.isArray(current.withdrawals)) current.withdrawals = [];
                        current.withdrawals.push(withdrawal);
                    }
                    return current;
                });
                // push admin withdraw record under adminWithdrawals (as a node)
                const adminRef = ref(db, `adminWithdrawals/${Date.now()}_${Math.random().toString(36).substr(2,9)}`);
                await set(adminRef, { ...withdrawal, status:'pending', processed:false, processedDate:null, adminNotes:'', userEmail: currentUser.email || '' });
                userData.balance = newBalance;
                if (!userData.withdrawals) userData.withdrawals = [];
                userData.withdrawals.push(withdrawal);
                showToast('Sucesso!', `Levantamento de ${formatCurrency(amount)} solicitado. Líquido: ${formatCurrency(netAmount)} para ${bankAccountData.bankName}.`, 'success');
                closeModal('withdrawalModal'); updateUI(); loadRecentTransactions();
            } catch (err) { console.error(err); showToast('Erro','Falha ao processar levantamento: '+err.message,'error'); }
        }

        // loadInvestmentPlans, selectPlan, confirmInvestment -> convert updates to RTDB
        function loadInvestmentPlans() {
            const container = document.getElementById('plansContainer'); if (!container) return;
            container.innerHTML = investmentPlans.map((plan,index)=>`<div class="plan-card" onclick="selectPlan(${index})" id="plan-${index}"><div style="font-size:0.85rem;color:var(--gray-light);margin-bottom:5px;">Plano ${index+1}</div><div class="plan-amount">${formatNumber(plan.amount)} Kz</div><div class="plan-daily">Diário: ${formatNumber(plan.daily)} Kz</div><div class="plan-period">${plan.period}</div>${plan.total?`<div style="font-size:0.8rem;color:var(--success);margin-top:5px;">Total: ${formatNumber(plan.total)} Kz</div>`:''}</div>`).join('');
        }

        function selectPlan(index) {
            if (hasActiveInvestment) { showToast('Atenção','Você já tem um investimento ativo. Para alterar, contacte o suporte.','warning'); return; }
            document.querySelectorAll('.plan-card').forEach(card=>card.classList.remove('selected'));
            const planCard = document.getElementById(`plan-${index}`); if (planCard) planCard.classList.add('selected');
            selectedPlan = investmentPlans[index];
            const detailsDiv = document.getElementById('selectedPlanDetails'); const contentDiv = document.getElementById('planDetailsContent');
            const hasSufficientBalance = userData && userData.balance >= selectedPlan.amount;
            if (contentDiv) contentDiv.innerHTML = `<p><strong>Investimento:</strong> ${formatNumber(selectedPlan.amount)} Kz</p><p><strong>Retorno Diário:</strong> ${formatNumber(selectedPlan.daily)} Kz</p><p><strong>Período:</strong> ${selectedPlan.period}</p>${selectedPlan.total?`<p><strong>Retorno Total:</strong> ${formatNumber(selectedPlan.total)} Kz</p>`:''}<p><strong>Pagamentos:</strong> Diários às 00:00</p><p><strong>Seu Saldo:</strong> ${formatNumber(userData?.balance||0)} Kz</p>${hasSufficientBalance?'<p style="color:#00c853;font-weight:bold;margin-top:10px;"><i class="fas fa-check-circle"></i> Saldo suficiente para investir</p>':'<p style="color:#f44336;font-weight:bold;margin-top:10px;"><i class="fas fa-exclamation-triangle"></i> Saldo insuficiente. Faça um depósito primeiro.</p>'}`;
            if (detailsDiv) { detailsDiv.style.display='block'; detailsDiv.scrollIntoView({behavior:'smooth', block:'nearest'}); }
        }

        async function confirmInvestment() {
            if (!selectedPlan) { showToast('Erro','Selecione um plano primeiro','error'); return; }
            if (!userData) { showToast('Erro','Erro ao carregar dados do usuário','error'); return; }
            if (hasActiveInvestment) { showToast('Erro','Você já tem um investimento ativo. Para alterar, contacte o suporte.','error'); return; }
            if (userData.balance < selectedPlan.amount) { showToast('Saldo Insuficiente','Faça um depósito primeiro','warning'); openModal('depositModal'); return; }
            try {
                const newBalance = userData.balance - selectedPlan.amount;
                const investment = { planAmount: selectedPlan.amount, dailyReturn: selectedPlan.daily, period: selectedPlan.period, startDate: new Date().toISOString(), lastDailyCredit: new Date().toISOString(), status:'active', totalEarned:0, id:'inv_'+Date.now()+'_'+Math.random().toString(36).substr(2,9) };
                // transaction to update user's balance and investments
                const userRef = ref(db, `users/${currentUser.uid}`);
                await runTransaction(userRef, current => {
                    if (current) {
                        current.balance = newBalance;
                        if (!Array.isArray(current.investments)) current.investments = [];
                        current.investments.push(investment);
                        current.hasInvestedBefore = true;
                    }
                    return current;
                });
                // local update
                userData.balance = newBalance;
                if (!userData.investments) userData.investments = [];
                userData.investments.push(investment);
                hasActiveInvestment = true;
                userData.hasInvestedBefore = true;
                // process referrer commission if applicable
                if (userData.referredBy) {
                    const q = query(ref(db,'users'), orderByChild('agentCode'), equalTo(userData.referredBy), limitToFirst(1));
                    const snap = await get(q);
                    if (snap.exists()) {
                        let referrerId = null, referrerData = null;
                        snap.forEach(child => { referrerId = child.key; referrerData = child.val(); });
                        if (referrerId && referrerData) {
                            const commissionAmount = selectedPlan.amount * 0.15;
                            const refRef = ref(db, `users/${referrerId}`);
                            await runTransaction(refRef, current => {
                                if (current) {
                                    current.balance = (current.balance||0) + commissionAmount;
                                    if (!current.earnings) current.earnings = {};
                                    current.earnings.commission = (current.earnings.commission||0) + commissionAmount;
                                    if (!Array.isArray(current.commissions)) current.commissions = [];
                                    current.commissions.push({ amount: commissionAmount, date:new Date().toISOString(), fromUserId: currentUser.uid, fromUserName: userData.fullName||'Referido', investmentAmount: selectedPlan.amount, type:'referral_commission' });
                                }
                                return current;
                            });
                        }
                    }
                }
                showToast('Sucesso!', `Você investiu ${formatNumber(selectedPlan.amount)} Kz no plano com retorno diário de ${formatNumber(selectedPlan.daily)} Kz.`, 'success');
                updateUI(); closeModal('investmentModal'); loadRecentTransactions();
                if (document.getElementById('myPlansScreen')?.classList.contains('active')) loadActivePlans();
            } catch (err) { console.error(err); showToast('Erro','Falha ao processar investimento: '+err.message,'error'); }
        }

        // submitCancelRequest -> push into cancelRequests node
        async function submitCancelRequest(event) {
            event.preventDefault();
            const reason = document.getElementById('cancelReason').value;
            const amount = document.getElementById('currentInvestment').value;
            const phone = document.getElementById('cancelPhone').value;
            if (!reason || !amount || !phone) { showToast('Erro','Preencha todos os campos','error'); return; }
            try {
                const cancelRequest = { reason, amount: parseFloat(amount), phone, date: new Date().toISOString(), status:'pending', userId: currentUser.uid, userName: userData.fullName, timestamp: Date.now() };
                const nodeRef = ref(db, `cancelRequests/${Date.now()}_${Math.random().toString(36).substr(2,9)}`);
                await set(nodeRef, cancelRequest);
                showToast('Solicitação Enviada!','Sua solicitação será analisada pela nossa equipe. Entraremos em contacto.','success');
                closeModal('cancelModal');
            } catch (err) { console.error(err); showToast('Erro','Falha ao enviar solicitação: '+err.message,'error'); }
        }

        function copyInviteLink() { const link = document.getElementById('inviteLinkText')?.textContent||''; navigator.clipboard.writeText(link).then(()=>showToast('Copiado!','Link de convite copiado para a área de transferência','success')); }
        function copyAgentCode() { const code = document.getElementById('profileAgentCode')?.textContent||''; navigator.clipboard.writeText(code).then(()=>showToast('Copiado!','Código de agente copiado','success')); }
        function openSupport() { window.open('https://t.me/Sensohumor','_blank'); }
        function showNotifications() { showToast('Notificações','Não há novas notificações','info'); }
        function logout() { if (confirm('Tem certeza que deseja sair?')) { signOut(auth).then(()=>{ window.location.href='signup.html'; }).catch(err=>{ console.error(err); showToast('Erro','Falha ao fazer logout','error'); }); } }

        function loadAnalyticsData() {
            if (!userData) return;
            const invested = calculateTotalInvested(); const daily = calculateDailyEarnings();
            const monthlyGrowth = invested? ((daily*30)/invested*100).toFixed(1) : '0.0';
            const annualProjection = daily*365;
            const mg = document.getElementById('monthlyGrowth'); if (mg) mg.textContent = monthlyGrowth + '%';
            const ap = document.getElementById('annualProjection'); if (ap) ap.textContent = formatCurrency(annualProjection);
            if (growthChart) { try { growthChart.destroy(); } catch(e){} growthChart=null; }
            const ctx = document.getElementById('growthChart'); if (!ctx) return;
            const chart = new Chart(ctx.getContext('2d'), { type:'line', data:{ labels:['Jan','Fev','Mar','Abr','Mai','Jun'], datasets:[{ label:'Crescimento (Kz)', data:[0, invested*0.3, invested*0.6, invested*0.9, invested, invested*1.3], borderColor:'#ff9800', backgroundColor:'rgba(255,152,0,0.1)', borderWidth:3, fill:true, tension:0.4 }] }, options:{ responsive:true, plugins:{ legend:{ display:false } }, scales:{ y:{ beginAtZero:true, ticks:{ color:'rgba(255,255,255,0.7)', callback:function(value){ return formatNumber(value)+' Kz'; } }, grid:{ color:'rgba(255,255,255,0.1)' } }, x:{ ticks:{ color:'rgba(255,255,255,0.7)' }, grid:{ color:'rgba(255,255,255,0.1)' } } } } });
            growthChart = chart;
        }

        function runSimulation() {
            const amount = parseFloat(document.getElementById('simulatorAmount')?.value);
            if (!amount || amount < 3000) { showToast('Erro','Valor mínimo para simulação é 3.000 Kz','error'); return; }
            let sel = investmentPlans[0]; for (const p of investmentPlans) { if (p.amount <= amount) sel = p; else break; }
            const dailyReturn = sel.daily; const weeklyReturn = dailyReturn*7; const monthlyReturn = dailyReturn*30; const annualReturn = dailyReturn*365;
            let totalWithCompound = amount; for (let i=0;i<365;i++){ totalWithCompound += (totalWithCompound * (dailyReturn/amount)); } totalWithCompound = Math.round(totalWithCompound);
            document.getElementById('simDaily').textContent = formatCurrency(dailyReturn);
            document.getElementById('simWeekly').textContent = formatCurrency(weeklyReturn);
            document.getElementById('simMonthly').textContent = formatCurrency(monthlyReturn);
            document.getElementById('simAnnual').textContent = formatCurrency(annualReturn);
            document.getElementById('simTotal').textContent = formatCurrency(totalWithCompound);
            const res = document.getElementById('simulationResults'); if (res) res.style.display='block';
        }

        function updateGoalsProgress() {
            if (!userData) return;
            const invested = calculateTotalInvested(); const balance = userData.balance || 0; const totalCapital = invested + balance;
            const g1 = Math.min(Math.round((totalCapital/500000)*100),100); const g2 = Math.min(Math.round((totalCapital/1500000)*100),100);
            const e1 = document.getElementById('goal1Progress'); if (e1) e1.textContent = g1 + '%';
            const e2 = document.getElementById('goal2Progress'); if (e2) e2.textContent = g2 + '%';
            const f1 = document.querySelector('#goalsList .goal-card:nth-child(1) .goal-progress-fill'); if (f1) f1.style.width = g1 + '%';
            const f2 = document.querySelector('#goalsList .goal-card:nth-child(2) .goal-progress-fill'); if (f2) f2.style.width = g2 + '%';
        }

        function addNewGoal(event) { event.preventDefault(); const goalName=document.getElementById('goalName').value; const goalAmount=parseFloat(document.getElementById('goalAmount').value); const goalDeadline=document.getElementById('goalDeadline').value; if(!goalName||!goalAmount||!goalDeadline){ showToast('Erro','Preencha todos os campos obrigatórios','error'); return; } showToast('Meta Criada!', `Meta "${goalName}" de ${formatCurrency(goalAmount)} adicionada com sucesso!`, 'success'); closeModal('addGoalModal'); updateGoalsProgress(); }

        function updatePlannerInfo() {
            if (!userData || !Array.isArray(userData.investments)) return;
            const activeInvestment = userData.investments.find(inv=>inv.status==='active');
            if (!activeInvestment) return;
            const startDate = new Date(activeInvestment.startDate || Date.now()); const now = new Date(); const daysActive = Math.floor((now - startDate)/(1000*60*60*24));
            const tomorrow = new Date(now); tomorrow.setDate(tomorrow.getDate()+1); tomorrow.setHours(0,0,0,0);
            const npd = document.getElementById('nextPaymentDay'); if (npd) npd.textContent = tomorrow.getDate();
            const daysActiveEl = document.getElementById('daysActive'); if (daysActiveEl) daysActiveEl.textContent = daysActive;
            const daysUntilMonday = (8 - now.getDay()) % 7 || 7; const subsidyDay = new Date(now); subsidyDay.setDate(subsidyDay.getDate()+daysUntilMonday); const days=['Dom','Seg','Ter','Qua','Qui','Sex','Sáb']; const sd = document.getElementById('subsidyDay'); if (sd) sd.textContent = days[subsidyDay.getDay()];
        }

        function terminateOtherSessions() { showToast('Sessões Terminadas','Todas as outras sessões foram terminadas com sucesso','success'); }

        // ---------------- Authentication state handling ----------------
        // Use onAuthStateChanged to attach real-time listener to /users/{uid} and redirect to signup if not logged in
        onAuthStateChanged(auth, async (user) => {
            if (user) {
                currentUser = user;
                // attach RTDB realtime listener
                attachUserListener(user.uid);
                // also load once to run initial setup actions
                await loadUserData();
                updateUI();
                loadRecentTransactions();
                showWelcomeNotification();
                await checkDailyEarnings();
                updatePlannerInfo();
            } else {
                // redirect to signup/login page
                window.location.href = 'signup.html';
            }
        });

        // ----------------- Expose functions globally for inline handlers -----------------
        // All functions that are called from HTML attributes must be on window
        const exported = [
            'toggleTheme','showNotifications','joinTelegramGroup','openModal','closeModal','showScreen',
            'selectDepositMethod','nextDepositStep','submitDeposit','selectBankAccountForWithdrawal','submitWithdrawal',
            'changeHistoryTab','confirmInvestment','submitCancelRequest','addBankAccount','copyInviteLink','copyAgentCode',
            'openSupport','logout','loadAnalyticsData','runSimulation','addNewGoal','terminateOtherSessions',
            'loadInvestmentPlans','selectPlan','loadActivePlans','loadRecentTransactions','loadBankAccountsForWithdrawal',
            'updateGoalsProgress','updatePlannerInfo','checkDailyEarnings','checkIfUserBanned','resetModals'
        ];
        exported.forEach(name => { try { window[name] = eval(name); } catch(e) { /* ignore if not defined */ } });

        // ----------------- Initialize basic UI listeners after DOM load -----------------
        document.addEventListener('DOMContentLoaded', function() {
            applySavedTheme();
            const depositAmount = document.getElementById('depositAmount');
            if (depositAmount) depositAmount.addEventListener('input', function() {
                const amount = parseFloat(this.value);
                const nextBtn = document.getElementById('nextDepositBtn');
                if (amount && amount >= 3000 && selectedDepositMethod) nextBtn.disabled = false; else nextBtn.disabled = true;
            });
            const withdrawAmount = document.getElementById('withdrawAmount'); const withdrawSchedule = document.getElementById('withdrawSchedule');
            if (withdrawAmount) withdrawAmount.addEventListener('input', calculateNetAmount);
            if (withdrawSchedule) withdrawSchedule.addEventListener('change', calculateNetAmount);
            const simulatorAmount = document.getElementById('simulatorAmount');
            if (simulatorAmount) simulatorAmount.addEventListener('keypress', function(e){ if (e.key==='Enter'){ runSimulation(); e.preventDefault(); }});
            window.addEventListener('click', function(e) {
                if (e.target.classList.contains('modal')) {
                    e.target.style.display = 'none';
                    if (e.target.id !== 'addGoalModal') resetModals();
                }
            });
            showScreen('home');
        });
    </script>
</body>
</html>